L.esri.Renderers={Renderers:{}},L.esri.Renderers.Symbol=L.Class.extend({initialize:function(a){this.symbolJson=a,this.val=0,this.styles={}},pixelValue:function(a){return 1.3333333333333*a},colorValue:function(a){return"rgb("+a[0]+","+a[1]+","+a[2]+")"},alphaValue:function(a){return a[3]/255}}),L.esri.Renderers.PointSymbol=L.esri.Renderers.Symbol.extend({statics:{SIMPLEMARKERTYPES:["esriSMSCircle","esriSMSCross","esriSMSDiamond","esriSMSSquare","esriSMSX"]},initialize:function(a){L.esri.Renderers.Symbol.prototype.initialize.call(this,a),this.fillStyles()},fillStyles:function(){"esriPMS"!==this.symbolJson.type&&(console.log(this.symbolJson),this.symbolJson.outline?(this.styles.stroke=!0,this.styles.weight=this.pixelValue(this.symbolJson.outline.width),this.styles.color=this.colorValue(this.symbolJson.outline.color),this.styles.opacity=this.alphaValue(this.symbolJson.outline.color)):this.styles.stroke=!1,this.styles.fillColor=this.colorValue(this.symbolJson.color),this.styles.fillOpacity=this.alphaValue(this.symbolJson.color),"esriSMSCircle"==this.symbolJson.style&&(this.styles.radius=this.pixelValue(this.symbolJson.size)/2))},pointToLayer:function(a,b){return"esriSMSCircle"===this.symbolJson.style?this.circleMarker(a,b):"esriPMS"===this.symbolJson.type?this.icon(b):void 0},icon:function(a){var b=L.icon({iconUrl:"http://services.arcgis.com/rOo16HdIMeOBI4Mb/arcgis/rest/services/minop3x020_nt00020/FeatureServer/0/images/cd844779-9244-4a1b-be20-cf7849945e48",iconRetinaUrl:"http://services.arcgis.com/rOo16HdIMeOBI4Mb/arcgis/rest/services/minop3x020_nt00020/FeatureServer/0/images/cd844779-9244-4a1b-be20-cf7849945e48",iconSize:[this.pixelValue(6),this.pixelValue(6)],iconAnchor:[17.5,13.5],popupAnchor:[0,-11]});return L.marker(a,{icon:b})},circleMarker:function(a,b){return L.circleMarker(b,this.styles)}}),L.esri.Renderers.LineSymbol=L.esri.Renderers.Symbol.extend({statics:{SIMPLELINETYPES:["esriSLSDash","esriSLSDot","esriSLSDashDotDot","esriSLSDashDot","esriSLSNull","esriSLSSolid"]},initialize:function(a){L.esri.Renderers.Symbol.prototype.initialize.call(this,a),this.fillStyles()},fillStyles:function(){switch(this.styles.weight=this.pixelValue(this.symbolJson.width),this.styles.color=this.colorValue(this.symbolJson.color),this.styles.opacity=this.alphaValue(this.symbolJson.color),this.symbolJson.style){case"esriSLSDash":this.styles.dashArray="6,6";break;case"esriSLSDot":this.styles.dashArray="2,6";break;case"esriSLSDashDot":this.styles.dashArray="9,6,2,6";break;case"esriSLSDashDotDot":this.styles.dashArray="9,6,1,6,1,6"}},style:function(){return this.styles}}),L.esri.Renderers.PolygonSymbol=L.esri.Renderers.Symbol.extend({statics:{SIMPLEPOLYGONTYPES:["esriSFSBackwardDiagonal","esriSFSCross","esriSFSDiagonalCross","esriSFSForwardDiagonal","esriSFSHorizontal","esriSFSNull","esriSFSSolid","esriSFSVertical"]},initialize:function(a){L.esri.Renderers.Symbol.prototype.initialize.call(this,a),this.lineSymbol=new L.esri.Renderers.LineSymbol(a.outline),L.esri.Renderers.PolygonSymbol.SIMPLEPOLYGONTYPES.indexOf(a.style)>=0&&this.fillStyles()},fillStyles:function(){this.styles.fillColor=this.colorValue(this.symbolJson.color),this.styles.fillOpacity=this.alphaValue(this.symbolJson.color),0==this.lineSymbol.styles.weight?this.styles.stroke=!1:(this.styles.weight=this.lineSymbol.styles.weight,this.styles.color=this.lineSymbol.styles.color,this.styles.opacity=this.lineSymbol.styles.opacity)},style:function(){return this.styles}}),L.esri.Renderers.Renderer=L.Class.extend({initialize:function(a,b){this.layer=b,this.metadata=a,this.rendererJson=a.drawingInfo.renderer},styleLayer:function(){var a=this.newSymbol(this.rendererJson.symbol);"esriGeometryPoint"==this.metadata.geometryType?this.layer.options.pointToLayer=L.Util.bind(a.pointToLayer,a):this.layer.options.style=L.Util.bind(a.style,a)},newSymbol:function(a){return"esriGeometryPoint"==this.metadata.geometryType?new L.esri.Renderers.PointSymbol(a):"esriGeometryPolyline"==this.metadata.geometryType?new L.esri.Renderers.LineSymbol(a):"esriGeometryPolygon"==this.metadata.geometryType?new L.esri.Renderers.PolygonSymbol(a):void 0}}),L.esri.Renderers.UniqueValueRenderer=L.esri.Renderers.Renderer.extend({initialize:function(a,b){L.esri.Renderers.Renderer.prototype.initialize.call(this,a,b),this.field=this.rendererJson.field1,this.symbols=[]},styleLayer:function(){this.createSymbols(),"esriGeometryPoint"==this.metadata.geometryType?this.layer.options.pointToLayer=L.Util.bind(this.pointToLayer,this):this.layer.options.style=L.Util.bind(this.style,this)},createSymbols:function(){for(var a,b=this.rendererJson.uniqueValueInfos,c=b.length-1;c>=0;c--)a=this.newSymbol(b[c].symbol),a.val=b[c].value,this.symbols.push(a)},getSymbol:function(a){for(var b=this.symbols[0],c=this.symbols.length-1;c>=0;c--)this.symbols[c].val==a&&(b=this.symbols[c]);return b},pointToLayer:function(a,b){var c=this.getSymbol(a.properties[this.field]);return c.pointToLayer(a,b)},style:function(a){var b=this.getSymbol(a.properties[this.field]);return b.style(a)}}),L.esri.Renderers.ClassBreaksRenderer=L.esri.Renderers.Renderer.extend({initialize:function(a,b){L.esri.Renderers.Renderer.prototype.initialize.call(this,a,b),this.field=this.rendererJson.field,this.symbols=[]},styleLayer:function(){this.createSymbols(),"esriGeometryPoint"==this.metadata.geometryType?this.layer.options.pointToLayer=L.Util.bind(this.pointToLayer,this):this.layer.options.style=L.Util.bind(this.style,this)},createSymbols:function(){for(var a,b=this.rendererJson.classBreakInfos,c=b.length-1;c>=0;c--)a=this.newSymbol(b[c].symbol),a.val=b[c].classMaxValue,this.symbols.push(a);this.symbols.sort(function(a,b){return a.val>b.val?1:-1})},getSymbol:function(a){for(var b=this.symbols[0],c=this.symbols.length-1;c>=0&&!(a>this.symbols[c].val);c--)b=this.symbols[c];return b},pointToLayer:function(a,b){var c=this.getSymbol(a.properties[this.field]);return c.pointToLayer(a,b)},style:function(a){var b=this.getSymbol(a.properties[this.field]);return b.style(a)}}),L.esri.FeatureLayer.addInitHook(function(){var a=L.Util.bind(this.onAdd,this);this._metadataLoaded=!1,this.metadata(function(b,c){if(console.log(c.drawingInfo.renderer),c.drawingInfo){var d=this.getRenderer(c);d.styleLayer(this)}this._metadataLoaded=!0,this._addToMap&&a(map)},this),this.onAdd=function(b){this._addToMap=!0,this._metadataLoaded&&a(b)},this.getRenderer=function(a){return"classBreaks"==a.drawingInfo.renderer.type?new L.esri.Renderers.ClassBreaksRenderer(a,this):"uniqueValue"==a.drawingInfo.renderer.type?new L.esri.Renderers.UniqueValueRenderer(a,this):new L.esri.Renderers.Renderer(a,this)}});