{"version":3,"file":"esri-leaflet-renderers.js","sources":["../src/Symbols/Symbol.js","../node_modules/leaflet-shape-markers/src/ShapeMarker.js","../node_modules/leaflet-shape-markers/src/CrossMarker.js","../node_modules/leaflet-shape-markers/src/XMarker.js","../node_modules/leaflet-shape-markers/src/SquareMarker.js","../node_modules/leaflet-shape-markers/src/DiamondMarker.js","../src/Symbols/PointSymbol.js","../src/Symbols/LineSymbol.js","../src/Symbols/PolygonSymbol.js","../src/Renderers/Renderer.js","../src/Renderers/SimpleRenderer.js","../src/Renderers/ClassBreaksRenderer.js","../src/Renderers/UniqueValueRenderer.js","../src/FeatureLayerHook.js"],"sourcesContent":["import L from 'leaflet';\r\n\r\nexport var Symbol = L.Class.extend({\r\n  initialize: function (symbolJson, options) {\r\n    this._symbolJson = symbolJson;\r\n    this.val = null;\r\n    this._styles = {};\r\n    this._isDefault = false;\r\n    this._layerTransparency = 1;\r\n    if (options && options.layerTransparency) {\r\n      this._layerTransparency = 1 - (options.layerTransparency / 100.0);\r\n    }\r\n  },\r\n\r\n  // the geojson values returned are in points\r\n  pixelValue: function (pointValue) {\r\n    return pointValue * 1.333;\r\n  },\r\n\r\n  // color is an array [r,g,b,a]\r\n  colorValue: function (color) {\r\n    return 'rgb(' + color[0] + ',' + color[1] + ',' + color[2] + ')';\r\n  },\r\n\r\n  alphaValue: function (color) {\r\n    var alpha = color[3] / 255.0;\r\n    return alpha * this._layerTransparency;\r\n  },\r\n\r\n  getSize: function (feature, sizeInfo) {\r\n    var attr = feature.properties;\r\n    var field = sizeInfo.field;\r\n    var size = 0;\r\n    var featureValue = null;\r\n\r\n    if (field) {\r\n      featureValue = attr[field];\r\n      var minSize = sizeInfo.minSize;\r\n      var maxSize = sizeInfo.maxSize;\r\n      var minDataValue = sizeInfo.minDataValue;\r\n      var maxDataValue = sizeInfo.maxDataValue;\r\n      var featureRatio;\r\n      var normField = sizeInfo.normalizationField;\r\n      var normValue = attr ? parseFloat(attr[normField]) : undefined;\r\n\r\n      if (featureValue === null || (normField && ((isNaN(normValue) || normValue === 0)))) {\r\n        return null;\r\n      }\r\n\r\n      if (!isNaN(normValue)) {\r\n        featureValue /= normValue;\r\n      }\r\n\r\n      if (minSize !== null && maxSize !== null && minDataValue !== null && maxDataValue !== null) {\r\n        if (featureValue <= minDataValue) {\r\n          size = minSize;\r\n        } else if (featureValue >= maxDataValue) {\r\n          size = maxSize;\r\n        } else {\r\n          featureRatio = (featureValue - minDataValue) / (maxDataValue - minDataValue);\r\n          size = minSize + (featureRatio * (maxSize - minSize));\r\n        }\r\n      }\r\n      size = isNaN(size) ? 0 : size;\r\n    }\r\n    return size;\r\n  },\r\n\r\n  getColor: function (feature, colorInfo) {\r\n    // required information to get color\r\n    if (!(feature.properties && colorInfo && colorInfo.field && colorInfo.stops)) {\r\n      return null;\r\n    }\r\n\r\n    var attr = feature.properties;\r\n    var featureValue = attr[colorInfo.field];\r\n    var lowerBoundColor, upperBoundColor, lowerBound, upperBound;\r\n    var normField = colorInfo.normalizationField;\r\n    var normValue = attr ? parseFloat(attr[normField]) : undefined;\r\n    if (featureValue === null || (normField && ((isNaN(normValue) || normValue === 0)))) {\r\n      return null;\r\n    }\r\n\r\n    if (!isNaN(normValue)) {\r\n      featureValue /= normValue;\r\n    }\r\n\r\n    if (featureValue <= colorInfo.stops[0].value) {\r\n      return colorInfo.stops[0].color;\r\n    }\r\n    var lastStop = colorInfo.stops[colorInfo.stops.length - 1];\r\n    if (featureValue >= lastStop.value) {\r\n      return lastStop.color;\r\n    }\r\n\r\n    // go through the stops to find min and max\r\n    for (var i = 0; i < colorInfo.stops.length; i++) {\r\n      var stopInfo = colorInfo.stops[i];\r\n\r\n      if (stopInfo.value <= featureValue) {\r\n        lowerBoundColor = stopInfo.color;\r\n        lowerBound = stopInfo.value;\r\n      } else if (stopInfo.value > featureValue) {\r\n        upperBoundColor = stopInfo.color;\r\n        upperBound = stopInfo.value;\r\n        break;\r\n      }\r\n    }\r\n\r\n    // feature falls between two stops, interplate the colors\r\n    if (!isNaN(lowerBound) && !isNaN(upperBound)) {\r\n      var range = upperBound - lowerBound;\r\n      if (range > 0) {\r\n        // more weight the further it is from the lower bound\r\n        var upperBoundColorWeight = (featureValue - lowerBound) / range;\r\n        if (upperBoundColorWeight) {\r\n          // more weight the further it is from the upper bound\r\n          var lowerBoundColorWeight = (upperBound - featureValue) / range;\r\n          if (lowerBoundColorWeight) {\r\n            // interpolate the lower and upper bound color by applying the\r\n            // weights to each of the rgba colors and adding them together\r\n            var interpolatedColor = [];\r\n            for (var j = 0; j < 4; j++) {\r\n              interpolatedColor[j] = Math.round((lowerBoundColor[j] * lowerBoundColorWeight) + (upperBoundColor[j] * upperBoundColorWeight));\r\n            }\r\n            return interpolatedColor;\r\n          } else {\r\n            // no difference between featureValue and upperBound, 100% of upperBoundColor\r\n            return upperBoundColor;\r\n          }\r\n        } else {\r\n          // no difference between featureValue and lowerBound, 100% of lowerBoundColor\r\n          return lowerBoundColor;\r\n        }\r\n      }\r\n    }\r\n    // if we get to here, none of the cases apply so return null\r\n    return null;\r\n  }\r\n});\r\n\r\n// export function symbol (symbolJson) {\r\n//   return new Symbol(symbolJson);\r\n// }\r\n\r\nexport default Symbol;\r\n","import L from 'leaflet';\n\nexport var ShapeMarker = L.Path.extend({\n\n  initialize: function (latlng, size, options) {\n    L.setOptions(this, options);\n    this._size = size;\n    this._latlng = L.latLng(latlng);\n    this._svgCanvasIncludes();\n  },\n\n  toGeoJSON: function () {\n    return L.GeoJSON.getFeature(this, {\n      type: 'Point',\n      coordinates: L.GeoJSON.latLngToCoords(this.getLatLng())\n    });\n  },\n\n  _svgCanvasIncludes: function () {\n    // implement in sub class\n  },\n\n  _project: function () {\n    this._point = this._map.latLngToLayerPoint(this._latlng);\n  },\n\n  _update: function () {\n    if (this._map) {\n      this._updatePath();\n    }\n  },\n\n  _updatePath: function () {\n    // implement in sub class\n  },\n\n  setLatLng: function (latlng) {\n    this._latlng = L.latLng(latlng);\n    this.redraw();\n    return this.fire('move', {latlng: this._latlng});\n  },\n\n  getLatLng: function () {\n    return this._latlng;\n  },\n\n  setSize: function (size) {\n    this._size = size;\n    return this.redraw();\n  },\n\n  getSize: function () {\n    return this._size;\n  }\n});\n","import L from 'leaflet';\nimport { ShapeMarker } from './ShapeMarker';\n\nexport var CrossMarker = ShapeMarker.extend({\n\n  initialize: function (latlng, size, options) {\n    ShapeMarker.prototype.initialize.call(this, latlng, size, options);\n  },\n\n  _updatePath: function () {\n    this._renderer._updateCrossMarker(this);\n  },\n\n  _svgCanvasIncludes: function () {\n    L.Canvas.include({\n      _updateCrossMarker: function (layer) {\n        var latlng = layer._point;\n        var offset = layer._size / 2.0;\n        var ctx = this._ctx;\n\n        ctx.beginPath();\n        ctx.moveTo(latlng.x, latlng.y + offset);\n        ctx.lineTo(latlng.x, latlng.y - offset);\n        this._fillStroke(ctx, layer);\n\n        ctx.moveTo(latlng.x - offset, latlng.y);\n        ctx.lineTo(latlng.x + offset, latlng.y);\n        this._fillStroke(ctx, layer);\n      }\n    });\n\n    L.SVG.include({\n      _updateCrossMarker: function (layer) {\n        var latlng = layer._point;\n        var offset = layer._size / 2.0;\n\n        if (L.Browser.vml) {\n          latlng._round();\n          offset = Math.round(offset);\n        }\n\n        var str = 'M' + latlng.x + ',' + (latlng.y + offset) +\n          'L' + latlng.x + ',' + (latlng.y - offset) +\n          'M' + (latlng.x - offset) + ',' + latlng.y +\n          'L' + (latlng.x + offset) + ',' + latlng.y;\n\n        this._setPath(layer, str);\n      }\n    });\n  }\n});\n\nexport var crossMarker = function (latlng, size, options) {\n  return new CrossMarker(latlng, size, options);\n};\n\nexport default crossMarker;\n","import L from 'leaflet';\nimport { ShapeMarker } from './ShapeMarker';\n\nexport var XMarker = ShapeMarker.extend({\n\n  initialize: function (latlng, size, options) {\n    ShapeMarker.prototype.initialize.call(this, latlng, size, options);\n  },\n\n  _updatePath: function () {\n    this._renderer._updateXMarker(this);\n  },\n\n  _svgCanvasIncludes: function () {\n    L.Canvas.include({\n      _updateXMarker: function (layer) {\n        var latlng = layer._point;\n        var offset = layer._size / 2.0;\n        var ctx = this._ctx;\n\n        ctx.beginPath();\n\n        ctx.moveTo(latlng.x + offset, latlng.y + offset);\n        ctx.lineTo(latlng.x - offset, latlng.y - offset);\n        this._fillStroke(ctx, layer);\n      }\n    });\n\n    L.SVG.include({\n      _updateXMarker: function (layer) {\n        var latlng = layer._point;\n        var offset = layer._size / 2.0;\n\n        if (L.Browser.vml) {\n          latlng._round();\n          offset = Math.round(offset);\n        }\n\n        var str = 'M' + (latlng.x + offset) + ',' + (latlng.y + offset) +\n          'L' + (latlng.x - offset) + ',' + (latlng.y - offset) +\n          'M' + (latlng.x - offset) + ',' + (latlng.y + offset) +\n          'L' + (latlng.x + offset) + ',' + (latlng.y - offset);\n\n        this._setPath(layer, str);\n      }\n    });\n  }\n});\n\nexport var xMarker = function (latlng, size, options) {\n  return new XMarker(latlng, size, options);\n};\n\nexport default xMarker;\n","import L from 'leaflet';\nimport { ShapeMarker } from './ShapeMarker';\n\nexport var SquareMarker = ShapeMarker.extend({\n  options: {\n    fill: true\n  },\n\n  initialize: function (latlng, size, options) {\n    ShapeMarker.prototype.initialize.call(this, latlng, size, options);\n  },\n\n  _updatePath: function () {\n    this._renderer._updateSquareMarker(this);\n  },\n\n  _svgCanvasIncludes: function () {\n    L.Canvas.include({\n      _updateSquareMarker: function (layer) {\n        var latlng = layer._point;\n        var offset = layer._size / 2.0;\n        var ctx = this._ctx;\n\n        ctx.beginPath();\n\n        ctx.moveTo(latlng.x + offset, latlng.y + offset);\n        ctx.lineTo(latlng.x - offset, latlng.y + offset);\n        ctx.lineTo(latlng.x - offset, latlng.y - offset);\n        ctx.lineTo(latlng.x + offset, latlng.y - offset);\n\n        ctx.closePath();\n\n        this._fillStroke(ctx, layer);\n      }\n    });\n\n    L.SVG.include({\n      _updateSquareMarker: function (layer) {\n        var latlng = layer._point;\n        var offset = layer._size / 2.0;\n\n        if (L.Browser.vml) {\n          latlng._round();\n          offset = Math.round(offset);\n        }\n\n        var str = 'M' + (latlng.x + offset) + ',' + (latlng.y + offset) +\n          'L' + (latlng.x - offset) + ',' + (latlng.y + offset) +\n          'L' + (latlng.x - offset) + ',' + (latlng.y - offset) +\n          'L' + (latlng.x + offset) + ',' + (latlng.y - offset);\n\n        str = str + (L.Browser.svg ? 'z' : 'x');\n\n        this._setPath(layer, str);\n      }\n    });\n  }\n});\n\nexport var squareMarker = function (latlng, size, options) {\n  return new SquareMarker(latlng, size, options);\n};\n\nexport default squareMarker;\n","import L from 'leaflet';\nimport { ShapeMarker } from './ShapeMarker';\n\nexport var DiamondMarker = ShapeMarker.extend({\n  options: {\n    fill: true\n  },\n\n  initialize: function (latlng, size, options) {\n    ShapeMarker.prototype.initialize.call(this, latlng, size, options);\n  },\n\n  _updatePath: function () {\n    this._renderer._updateDiamondMarker(this);\n  },\n\n  _svgCanvasIncludes: function () {\n    L.Canvas.include({\n      _updateDiamondMarker: function (layer) {\n        var latlng = layer._point;\n        var offset = layer._size / 2.0;\n        var ctx = this._ctx;\n\n        ctx.beginPath();\n\n        ctx.moveTo(latlng.x, latlng.y + offset);\n        ctx.lineTo(latlng.x - offset, latlng.y);\n        ctx.lineTo(latlng.x, latlng.y - offset);\n        ctx.lineTo(latlng.x + offset, latlng.y);\n\n        ctx.closePath();\n\n        this._fillStroke(ctx, layer);\n      }\n    });\n\n    L.SVG.include({\n      _updateDiamondMarker: function (layer) {\n        var latlng = layer._point;\n        var offset = layer._size / 2.0;\n\n        if (L.Browser.vml) {\n          latlng._round();\n          offset = Math.round(offset);\n        }\n\n        var str = 'M' + latlng.x + ',' + (latlng.y + offset) +\n          'L' + (latlng.x - offset) + ',' + latlng.y +\n          'L' + latlng.x + ',' + (latlng.y - offset) +\n          'L' + (latlng.x + offset) + ',' + latlng.y;\n\n        str = str + (L.Browser.svg ? 'z' : 'x');\n\n        this._setPath(layer, str);\n      }\n    });\n  }\n});\n\nexport var diamondMarker = function (latlng, size, options) {\n  return new DiamondMarker(latlng, size, options);\n};\n\nexport default diamondMarker;\n","import L from 'leaflet';\r\nimport Symbol from './Symbol';\r\nimport {squareMarker, xMarker, crossMarker, diamondMarker} from 'leaflet-shape-markers';\r\n\r\nexport var PointSymbol = Symbol.extend({\r\n\r\n  statics: {\r\n    MARKERTYPES: ['esriSMSCircle', 'esriSMSCross', 'esriSMSDiamond', 'esriSMSSquare', 'esriSMSX', 'esriPMS']\r\n  },\r\n\r\n  initialize: function (symbolJson, options) {\r\n    var url;\r\n    Symbol.prototype.initialize.call(this, symbolJson, options);\r\n    if (options) {\r\n      this.serviceUrl = options.url;\r\n    }\r\n    if (symbolJson) {\r\n      if (symbolJson.type === 'esriPMS') {\r\n        var imageUrl = this._symbolJson.url;\r\n        if ((imageUrl && imageUrl.substr(0, 7) === 'http://') || (imageUrl.substr(0, 8) === 'https://')) {\r\n          // web image\r\n          url = this.sanitize(imageUrl);\r\n          this._iconUrl = url;\r\n        } else {\r\n          url = this.serviceUrl + 'images/' + imageUrl;\r\n          this._iconUrl = options && options.token ? url + '?token=' + options.token : url;\r\n        }\r\n        if (symbolJson.imageData) {\r\n          this._iconUrl = 'data:' + symbolJson.contentType + ';base64,' + symbolJson.imageData;\r\n        }\r\n        // leaflet does not allow resizing icons so keep a hash of different\r\n        // icon sizes to try and keep down on the number of icons created\r\n        this._icons = {};\r\n        // create base icon\r\n        this.icon = this._createIcon(this._symbolJson);\r\n      } else {\r\n        this._fillStyles();\r\n      }\r\n    }\r\n  },\r\n\r\n  // prevent html injection in strings\r\n  sanitize: function (str) {\r\n    if (!str) {\r\n      return '';\r\n    }\r\n    var text;\r\n    try {\r\n      // removes html but leaves url link text\r\n      text = str.replace(/<br>/gi, '\\n');\r\n      text = text.replace(/<p.*>/gi, '\\n');\r\n      text = text.replace(/<a.*href='(.*?)'.*>(.*?)<\\/a>/gi, ' $2 ($1) ');\r\n      text = text.replace(/<(?:.|\\s)*?>/g, '');\r\n    } catch (ex) {\r\n      text = null;\r\n    }\r\n    return text;\r\n  },\r\n\r\n  _fillStyles: function () {\r\n    if (this._symbolJson.outline && this._symbolJson.size > 0 && this._symbolJson.outline.style !== 'esriSLSNull') {\r\n      this._styles.stroke = true;\r\n      this._styles.weight = this.pixelValue(this._symbolJson.outline.width);\r\n      this._styles.color = this.colorValue(this._symbolJson.outline.color);\r\n      this._styles.opacity = this.alphaValue(this._symbolJson.outline.color);\r\n    } else {\r\n      this._styles.stroke = false;\r\n    }\r\n    if (this._symbolJson.color) {\r\n      this._styles.fillColor = this.colorValue(this._symbolJson.color);\r\n      this._styles.fillOpacity = this.alphaValue(this._symbolJson.color);\r\n    } else {\r\n      this._styles.fillOpacity = 0;\r\n    }\r\n\r\n    if (this._symbolJson.style === 'esriSMSCircle') {\r\n      this._styles.radius = this.pixelValue(this._symbolJson.size) / 2.0;\r\n    }\r\n  },\r\n\r\n  _createIcon: function (options) {\r\n    var width = this.pixelValue(options.width);\r\n    var height = width;\r\n    if (options.height) {\r\n      height = this.pixelValue(options.height);\r\n    }\r\n    var xOffset = width / 2.0;\r\n    var yOffset = height / 2.0;\r\n\r\n    if (options.xoffset) {\r\n      xOffset += this.pixelValue(options.xoffset);\r\n    }\r\n    if (options.yoffset) {\r\n      yOffset += this.pixelValue(options.yoffset);\r\n    }\r\n\r\n    var icon = L.icon({\r\n      iconUrl: this._iconUrl,\r\n      iconSize: [width, height],\r\n      iconAnchor: [xOffset, yOffset]\r\n    });\r\n    this._icons[options.width.toString()] = icon;\r\n    return icon;\r\n  },\r\n\r\n  _getIcon: function (size) {\r\n    // check to see if it is already created by size\r\n    var icon = this._icons[size.toString()];\r\n    if (!icon) {\r\n      icon = this._createIcon({width: size});\r\n    }\r\n    return icon;\r\n  },\r\n\r\n  pointToLayer: function (geojson, latlng, visualVariables, options) {\r\n    var size = this._symbolJson.size || this._symbolJson.width;\r\n    if (!this._isDefault) {\r\n      if (visualVariables.sizeInfo) {\r\n        var calculatedSize = this.getSize(geojson, visualVariables.sizeInfo);\r\n        if (calculatedSize) {\r\n          size = calculatedSize;\r\n        }\r\n      }\r\n      if (visualVariables.colorInfo) {\r\n        var color = this.getColor(geojson, visualVariables.colorInfo);\r\n        if (color) {\r\n          this._styles.fillColor = this.colorValue(color);\r\n          this._styles.fillOpacity = this.alphaValue(color);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this._symbolJson.type === 'esriPMS') {\r\n      var layerOptions = L.extend({}, {icon: this._getIcon(size)}, options);\r\n      return L.marker(latlng, layerOptions);\r\n    }\r\n    size = this.pixelValue(size);\r\n\r\n    switch (this._symbolJson.style) {\r\n      case 'esriSMSSquare':\r\n        return squareMarker(latlng, size, L.extend({}, this._styles, options));\r\n      case 'esriSMSDiamond':\r\n        return diamondMarker(latlng, size, L.extend({}, this._styles, options));\r\n      case 'esriSMSCross':\r\n        return crossMarker(latlng, size, L.extend({}, this._styles, options));\r\n      case 'esriSMSX':\r\n        return xMarker(latlng, size, L.extend({}, this._styles, options));\r\n    }\r\n    this._styles.radius = size / 2.0;\r\n    return L.circleMarker(latlng, L.extend({}, this._styles, options));\r\n  }\r\n});\r\n\r\nexport function pointSymbol (symbolJson, options) {\r\n  return new PointSymbol(symbolJson, options);\r\n}\r\n\r\nexport default pointSymbol;\r\n","import Symbol from './Symbol';\r\n\r\nexport var LineSymbol = Symbol.extend({\r\n  statics: {\r\n    // Not implemented 'esriSLSNull'\r\n    LINETYPES: ['esriSLSDash', 'esriSLSDot', 'esriSLSDashDotDot', 'esriSLSDashDot', 'esriSLSSolid']\r\n  },\r\n  initialize: function (symbolJson, options) {\r\n    Symbol.prototype.initialize.call(this, symbolJson, options);\r\n    this._fillStyles();\r\n  },\r\n\r\n  _fillStyles: function () {\r\n    // set the defaults that show up on arcgis online\r\n    this._styles.lineCap = 'butt';\r\n    this._styles.lineJoin = 'miter';\r\n    this._styles.fill = false;\r\n    this._styles.weight = 0;\r\n\r\n    if (!this._symbolJson) {\r\n      return this._styles;\r\n    }\r\n\r\n    if (this._symbolJson.color) {\r\n      this._styles.color = this.colorValue(this._symbolJson.color);\r\n      this._styles.opacity = this.alphaValue(this._symbolJson.color);\r\n    }\r\n\r\n    if (!isNaN(this._symbolJson.width)) {\r\n      this._styles.weight = this.pixelValue(this._symbolJson.width);\r\n\r\n      var dashValues = [];\r\n\r\n      switch (this._symbolJson.style) {\r\n        case 'esriSLSDash':\r\n          dashValues = [4, 3];\r\n          break;\r\n        case 'esriSLSDot':\r\n          dashValues = [1, 3];\r\n          break;\r\n        case 'esriSLSDashDot':\r\n          dashValues = [8, 3, 1, 3];\r\n          break;\r\n        case 'esriSLSDashDotDot':\r\n          dashValues = [8, 3, 1, 3, 1, 3];\r\n          break;\r\n      }\r\n\r\n      // use the dash values and the line weight to set dash array\r\n      if (dashValues.length > 0) {\r\n        for (var i = 0; i < dashValues.length; i++) {\r\n          dashValues[i] *= this._styles.weight;\r\n        }\r\n\r\n        this._styles.dashArray = dashValues.join(',');\r\n      }\r\n    }\r\n  },\r\n\r\n  style: function (feature, visualVariables) {\r\n    if (!this._isDefault && visualVariables) {\r\n      if (visualVariables.sizeInfo) {\r\n        var calculatedSize = this.pixelValue(this.getSize(feature, visualVariables.sizeInfo));\r\n        if (calculatedSize) {\r\n          this._styles.weight = calculatedSize;\r\n        }\r\n      }\r\n      if (visualVariables.colorInfo) {\r\n        var color = this.getColor(feature, visualVariables.colorInfo);\r\n        if (color) {\r\n          this._styles.color = this.colorValue(color);\r\n          this._styles.opacity = this.alphaValue(color);\r\n        }\r\n      }\r\n    }\r\n    return this._styles;\r\n  }\r\n});\r\n\r\nexport function lineSymbol (symbolJson, options) {\r\n  return new LineSymbol(symbolJson, options);\r\n}\r\n\r\nexport default lineSymbol;\r\n","import Symbol from './Symbol';\r\nimport lineSymbol from './LineSymbol';\r\n\r\nexport var PolygonSymbol = Symbol.extend({\r\n  statics: {\r\n    // not implemented: 'esriSFSBackwardDiagonal','esriSFSCross','esriSFSDiagonalCross','esriSFSForwardDiagonal','esriSFSHorizontal','esriSFSNull','esriSFSVertical'\r\n    POLYGONTYPES: ['esriSFSSolid']\r\n  },\r\n  initialize: function (symbolJson, options) {\r\n    Symbol.prototype.initialize.call(this, symbolJson, options);\r\n    if (symbolJson) {\r\n      if (symbolJson.outline && symbolJson.outline.style === 'esriSLSNull') {\r\n        this._lineStyles = { weight: 0 };\r\n      } else {\r\n        this._lineStyles = lineSymbol(symbolJson.outline, options).style();\r\n      }\r\n      this._fillStyles();\r\n    }\r\n  },\r\n\r\n  _fillStyles: function () {\r\n    if (this._lineStyles) {\r\n      if (this._lineStyles.weight === 0) {\r\n        // when weight is 0, setting the stroke to false can still look bad\r\n        // (gaps between the polygons)\r\n        this._styles.stroke = false;\r\n      } else {\r\n        // copy the line symbol styles into this symbol's styles\r\n        for (var styleAttr in this._lineStyles) {\r\n          this._styles[styleAttr] = this._lineStyles[styleAttr];\r\n        }\r\n      }\r\n    }\r\n\r\n    // set the fill for the polygon\r\n    if (this._symbolJson) {\r\n      if (this._symbolJson.color &&\r\n          // don't fill polygon if type is not supported\r\n          PolygonSymbol.POLYGONTYPES.indexOf(this._symbolJson.style >= 0)) {\r\n        this._styles.fill = true;\r\n        this._styles.fillColor = this.colorValue(this._symbolJson.color);\r\n        this._styles.fillOpacity = this.alphaValue(this._symbolJson.color);\r\n      } else {\r\n        this._styles.fill = false;\r\n        this._styles.fillOpacity = 0;\r\n      }\r\n    }\r\n  },\r\n\r\n  style: function (feature, visualVariables) {\r\n    if (!this._isDefault && visualVariables && visualVariables.colorInfo) {\r\n      var color = this.getColor(feature, visualVariables.colorInfo);\r\n      if (color) {\r\n        this._styles.fillColor = this.colorValue(color);\r\n        this._styles.fillOpacity = this.alphaValue(color);\r\n      }\r\n    }\r\n    return this._styles;\r\n  }\r\n});\r\n\r\nexport function polygonSymbol (symbolJson, options) {\r\n  return new PolygonSymbol(symbolJson, options);\r\n}\r\n\r\nexport default polygonSymbol;\r\n","import L from 'leaflet';\r\n\r\nimport pointSymbol from '../Symbols/PointSymbol';\r\nimport lineSymbol from '../Symbols/LineSymbol';\r\nimport polygonSymbol from '../Symbols/PolygonSymbol';\r\n\r\nexport var Renderer = L.Class.extend({\r\n  options: {\r\n    proportionalPolygon: false,\r\n    clickable: true\r\n  },\r\n\r\n  initialize: function (rendererJson, options) {\r\n    this._rendererJson = rendererJson;\r\n    this._pointSymbols = false;\r\n    this._symbols = [];\r\n    this._visualVariables = this._parseVisualVariables(rendererJson.visualVariables);\r\n    L.Util.setOptions(this, options);\r\n  },\r\n\r\n  _parseVisualVariables: function (visualVariables) {\r\n    var visVars = {};\r\n    if (visualVariables) {\r\n      for (var i = 0; i < visualVariables.length; i++) {\r\n        visVars[visualVariables[i].type] = visualVariables[i];\r\n      }\r\n    }\r\n    return visVars;\r\n  },\r\n\r\n  _createDefaultSymbol: function () {\r\n    if (this._rendererJson.defaultSymbol) {\r\n      this._defaultSymbol = this._newSymbol(this._rendererJson.defaultSymbol);\r\n      this._defaultSymbol._isDefault = true;\r\n    }\r\n  },\r\n\r\n  _newSymbol: function (symbolJson) {\r\n    if (symbolJson.type === 'esriSMS' || symbolJson.type === 'esriPMS') {\r\n      this._pointSymbols = true;\r\n      return pointSymbol(symbolJson, this.options);\r\n    }\r\n    if (symbolJson.type === 'esriSLS') {\r\n      return lineSymbol(symbolJson, this.options);\r\n    }\r\n    if (symbolJson.type === 'esriSFS') {\r\n      return polygonSymbol(symbolJson, this.options);\r\n    }\r\n  },\r\n\r\n  _getSymbol: function () {\r\n    // override\r\n  },\r\n\r\n  attachStylesToLayer: function (layer) {\r\n    if (this._pointSymbols) {\r\n      layer.options.pointToLayer = L.Util.bind(this.pointToLayer, this);\r\n    } else {\r\n      layer.options.style = L.Util.bind(this.style, this);\r\n      layer._originalStyle = layer.options.style;\r\n    }\r\n  },\r\n\r\n  pointToLayer: function (geojson, latlng) {\r\n    var sym = this._getSymbol(geojson);\r\n    if (sym && sym.pointToLayer) {\r\n      // right now custom panes are the only option pushed through\r\n      return sym.pointToLayer(geojson, latlng, this._visualVariables, this.options);\r\n    }\r\n    // invisible symbology\r\n    return L.circleMarker(latlng, {radius: 0, opacity: 0});\r\n  },\r\n\r\n  style: function (feature) {\r\n    var userStyles;\r\n    if (this.options.userDefinedStyle) {\r\n      userStyles = this.options.userDefinedStyle(feature);\r\n    }\r\n    // find the symbol to represent this feature\r\n    var sym = this._getSymbol(feature);\r\n    if (sym) {\r\n      return this.mergeStyles(sym.style(feature, this._visualVariables), userStyles);\r\n    } else {\r\n      // invisible symbology\r\n      return this.mergeStyles({opacity: 0, fillOpacity: 0}, userStyles);\r\n    }\r\n  },\r\n\r\n  mergeStyles: function (styles, userStyles) {\r\n    var mergedStyles = {};\r\n    var attr;\r\n    // copy renderer style attributes\r\n    for (attr in styles) {\r\n      if (styles.hasOwnProperty(attr)) {\r\n        mergedStyles[attr] = styles[attr];\r\n      }\r\n    }\r\n    // override with user defined style attributes\r\n    if (userStyles) {\r\n      for (attr in userStyles) {\r\n        if (userStyles.hasOwnProperty(attr)) {\r\n          mergedStyles[attr] = userStyles[attr];\r\n        }\r\n      }\r\n    }\r\n    return mergedStyles;\r\n  }\r\n});\r\n\r\nexport default Renderer;\r\n","import Renderer from './Renderer';\r\n\r\nexport var SimpleRenderer = Renderer.extend({\r\n  initialize: function (rendererJson, options) {\r\n    Renderer.prototype.initialize.call(this, rendererJson, options);\r\n    this._createSymbol();\r\n  },\r\n\r\n  _createSymbol: function () {\r\n    if (this._rendererJson.symbol) {\r\n      this._symbols.push(this._newSymbol(this._rendererJson.symbol));\r\n    }\r\n  },\r\n\r\n  _getSymbol: function () {\r\n    return this._symbols[0];\r\n  }\r\n});\r\n\r\nexport function simpleRenderer (rendererJson, options) {\r\n  return new SimpleRenderer(rendererJson, options);\r\n}\r\n\r\nexport default simpleRenderer;\r\n","import Renderer from './Renderer';\r\n\r\nexport var ClassBreaksRenderer = Renderer.extend({\r\n  initialize: function (rendererJson, options) {\r\n    Renderer.prototype.initialize.call(this, rendererJson, options);\r\n    this._field = this._rendererJson.field;\r\n    if (this._rendererJson.normalizationType && this._rendererJson.normalizationType === 'esriNormalizeByField') {\r\n      this._normalizationField = this._rendererJson.normalizationField;\r\n    }\r\n    this._createSymbols();\r\n  },\r\n\r\n  _createSymbols: function () {\r\n    var symbol;\r\n    var classbreaks = this._rendererJson.classBreakInfos;\r\n\r\n    this._symbols = [];\r\n\r\n    // create a symbol for each class break\r\n    for (var i = classbreaks.length - 1; i >= 0; i--) {\r\n      if (this.options.proportionalPolygon && this._rendererJson.backgroundFillSymbol) {\r\n        symbol = this._newSymbol(this._rendererJson.backgroundFillSymbol);\r\n      } else {\r\n        symbol = this._newSymbol(classbreaks[i].symbol);\r\n      }\r\n      symbol.val = classbreaks[i].classMaxValue;\r\n      this._symbols.push(symbol);\r\n    }\r\n    // sort the symbols in ascending value\r\n    this._symbols.sort(function (a, b) {\r\n      return a.val > b.val ? 1 : -1;\r\n    });\r\n    this._createDefaultSymbol();\r\n    this._maxValue = this._symbols[this._symbols.length - 1].val;\r\n  },\r\n\r\n  _getSymbol: function (feature) {\r\n    var val = feature.properties[this._field];\r\n    if (this._normalizationField) {\r\n      var normValue = feature.properties[this._normalizationField];\r\n      if (!isNaN(normValue) && normValue !== 0) {\r\n        val = val / normValue;\r\n      } else {\r\n        return this._defaultSymbol;\r\n      }\r\n    }\r\n\r\n    if (val > this._maxValue) {\r\n      return this._defaultSymbol;\r\n    }\r\n    var symbol = this._symbols[0];\r\n    for (var i = this._symbols.length - 1; i >= 0; i--) {\r\n      if (val > this._symbols[i].val) {\r\n        break;\r\n      }\r\n      symbol = this._symbols[i];\r\n    }\r\n    return symbol;\r\n  }\r\n});\r\n\r\nexport function classBreaksRenderer (rendererJson, options) {\r\n  return new ClassBreaksRenderer(rendererJson, options);\r\n}\r\n\r\nexport default classBreaksRenderer;\r\n","import Renderer from './Renderer';\r\n\r\nexport var UniqueValueRenderer = Renderer.extend({\r\n  initialize: function (rendererJson, options) {\r\n    Renderer.prototype.initialize.call(this, rendererJson, options);\r\n    this._field = this._rendererJson.field1;\r\n    this._createSymbols();\r\n  },\r\n\r\n  _createSymbols: function () {\r\n    var symbol;\r\n    var uniques = this._rendererJson.uniqueValueInfos;\r\n\r\n    // create a symbol for each unique value\r\n    for (var i = uniques.length - 1; i >= 0; i--) {\r\n      symbol = this._newSymbol(uniques[i].symbol);\r\n      symbol.val = uniques[i].value;\r\n      this._symbols.push(symbol);\r\n    }\r\n    this._createDefaultSymbol();\r\n  },\r\n\r\n  _getSymbol: function (feature) {\r\n    var val = feature.properties[this._field];\r\n    // accumulate values if there is more than one field defined\r\n    if (this._rendererJson.fieldDelimiter && this._rendererJson.field2) {\r\n      var val2 = feature.properties[this._rendererJson.field2];\r\n      if (val2) {\r\n        val += this._rendererJson.fieldDelimiter + val2;\r\n        var val3 = feature.properties[this._rendererJson.field3];\r\n        if (val3) {\r\n          val += this._rendererJson.fieldDelimiter + val3;\r\n        }\r\n      }\r\n    }\r\n\r\n    var symbol = this._defaultSymbol;\r\n    for (var i = this._symbols.length - 1; i >= 0; i--) {\r\n      // using the === operator does not work if the field\r\n      // of the unique renderer is not a string\r\n      /*eslint-disable */\r\n      if (this._symbols[i].val == val) {\r\n        symbol = this._symbols[i];\r\n      }\r\n      /*eslint-enable */\r\n    }\r\n    return symbol;\r\n  }\r\n});\r\n\r\nexport function uniqueValueRenderer (rendererJson, options) {\r\n  return new UniqueValueRenderer(rendererJson, options);\r\n}\r\n\r\nexport default uniqueValueRenderer;\r\n","import L from 'leaflet';\r\nimport Esri from 'esri-leaflet';\r\nimport classBreaksRenderer from './Renderers/ClassBreaksRenderer';\r\nimport uniqueValueRenderer from './Renderers/UniqueValueRenderer';\r\nimport simpleRenderer from './Renderers/SimpleRenderer';\r\n\r\nfunction wireUpRenderers () {\r\n  if (this.options.ignoreRenderer) {\r\n    return;\r\n  }\r\n  var oldOnAdd = L.Util.bind(this.onAdd, this);\r\n  var oldUnbindPopup = L.Util.bind(this.unbindPopup, this);\r\n  var oldOnRemove = L.Util.bind(this.onRemove, this);\r\n\r\n  this.onAdd = function (map) {\r\n    this.metadata(function (error, response) {\r\n      if (error) {\r\n        console.warn('failed to load metadata from the service.');\r\n        return;\r\n      } if (response && response.drawingInfo) {\r\n        if (this.options.drawingInfo) {\r\n          // allow L.esri.webmap (and others) to override service symbology with info provided in layer constructor\r\n          response.drawingInfo = this.options.drawingInfo;\r\n        }\r\n\r\n        // the default pane for lines and polygons is 'overlayPane', for points it is 'markerPane'\r\n        if (this.options.pane === 'overlayPane' && response.geometryType === 'esriGeometryPoint') {\r\n          this.options.pane = 'markerPane';\r\n        }\r\n\r\n        this._setRenderers(response);\r\n        oldOnAdd(map);\r\n        this._addPointLayer(map);\r\n      }\r\n    }, this);\r\n  };\r\n\r\n  this.onRemove = function (map) {\r\n    oldOnRemove(map);\r\n    if (this._pointLayer) {\r\n      var pointLayers = this._pointLayer.getLayers();\r\n      for (var i in pointLayers) {\r\n        map.removeLayer(pointLayers[i]);\r\n      }\r\n    }\r\n  };\r\n\r\n  this.unbindPopup = function () {\r\n    oldUnbindPopup();\r\n    if (this._pointLayer) {\r\n      var pointLayers = this._pointLayer.getLayers();\r\n      for (var i in pointLayers) {\r\n        pointLayers[i].unbindPopup();\r\n      }\r\n    }\r\n  };\r\n\r\n  this._addPointLayer = function (map) {\r\n    if (this._pointLayer) {\r\n      this._pointLayer.addTo(map);\r\n      this._pointLayer.bringToFront();\r\n    }\r\n  };\r\n\r\n  this._createPointLayer = function () {\r\n    if (!this._pointLayer) {\r\n      this._pointLayer = L.geoJson();\r\n      // store the feature ids that have already been added to the map\r\n      this._pointLayerIds = {};\r\n\r\n      if (this._popup) {\r\n        var popupFunction = function (feature, layer) {\r\n          layer.bindPopup(this._popup(feature, layer), this._popupOptions);\r\n        };\r\n        this._pointLayer.options.onEachFeature = L.Util.bind(popupFunction, this);\r\n      }\r\n    }\r\n  };\r\n\r\n  this.createNewLayer = function (geojson) {\r\n    var fLayer = L.GeoJSON.geometryToLayer(geojson, this.options);\r\n\r\n    // add a point layer when the polygon is represented as proportional marker symbols\r\n    if (this._hasProportionalSymbols) {\r\n      var centroid = this.getPolygonCentroid(geojson.geometry.coordinates);\r\n      if (!(isNaN(centroid[0]) || isNaN(centroid[0]))) {\r\n        this._createPointLayer();\r\n\r\n        var featureId = geojson.id.toString();\r\n        // only add the feature if it does not already exist on the map\r\n        if (!this._pointLayerIds[featureId]) {\r\n          var pointjson = this.getPointJson(geojson, centroid);\r\n\r\n          this._pointLayer.addData(pointjson);\r\n          this._pointLayerIds[featureId] = true;\r\n        }\r\n\r\n        this._pointLayer.bringToFront();\r\n      }\r\n    }\r\n    return fLayer;\r\n  };\r\n\r\n  this.getPolygonCentroid = function (coordinates) {\r\n    var pts = coordinates[0][0];\r\n    if (pts.length === 2) {\r\n      pts = coordinates[0];\r\n    }\r\n\r\n    var twicearea = 0;\r\n    var x = 0;\r\n    var y = 0;\r\n    var nPts = pts.length;\r\n    var p1;\r\n    var p2;\r\n    var f;\r\n\r\n    for (var i = 0, j = nPts - 1; i < nPts; j = i++) {\r\n      p1 = pts[i]; p2 = pts[j];\r\n      twicearea += p1[0] * p2[1];\r\n      twicearea -= p1[1] * p2[0];\r\n      f = (p1[0] * p2[1]) - (p2[0] * p1[1]);\r\n      x += (p1[0] + p2[0]) * f;\r\n      y += (p1[1] + p2[1]) * f;\r\n    }\r\n    f = twicearea * 3;\r\n    return [x / f, y / f];\r\n  };\r\n\r\n  this.getPointJson = function (geojson, centroid) {\r\n    return {\r\n      type: 'Feature',\r\n      properties: geojson.properties,\r\n      id: geojson.id,\r\n      geometry: {\r\n        type: 'Point',\r\n        coordinates: [centroid[0], centroid[1]]\r\n      }\r\n    };\r\n  };\r\n\r\n  this._checkForProportionalSymbols = function (geometryType, renderer) {\r\n    this._hasProportionalSymbols = false;\r\n    if (geometryType === 'esriGeometryPolygon') {\r\n      if (renderer.backgroundFillSymbol) {\r\n        this._hasProportionalSymbols = true;\r\n      }\r\n      // check to see if the first symbol in the classbreaks is a marker symbol\r\n      if (renderer.classBreakInfos && renderer.classBreakInfos.length) {\r\n        var sym = renderer.classBreakInfos[0].symbol;\r\n        if (sym && (sym.type === 'esriSMS' || sym.type === 'esriPMS')) {\r\n          this._hasProportionalSymbols = true;\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  this._setRenderers = function (serviceInfo) {\r\n    var rend;\r\n    var rendererInfo = serviceInfo.drawingInfo.renderer;\r\n\r\n    var options = {\r\n      url: this.options.url\r\n    };\r\n\r\n    if (this.options.token) {\r\n      options.token = this.options.token;\r\n    }\r\n\r\n    if (this.options.pane) {\r\n      options.pane = this.options.pane;\r\n    }\r\n\r\n    if (serviceInfo.drawingInfo.transparency) {\r\n      options.layerTransparency = serviceInfo.drawingInfo.transparency;\r\n    }\r\n\r\n    if (this.options.style) {\r\n      options.userDefinedStyle = this.options.style;\r\n    }\r\n\r\n    switch (rendererInfo.type) {\r\n      case 'classBreaks':\r\n        this._checkForProportionalSymbols(serviceInfo.geometryType, rendererInfo);\r\n        if (this._hasProportionalSymbols) {\r\n          this._createPointLayer();\r\n          var pRend = classBreaksRenderer(rendererInfo, options);\r\n          pRend.attachStylesToLayer(this._pointLayer);\r\n          options.proportionalPolygon = true;\r\n        }\r\n        rend = classBreaksRenderer(rendererInfo, options);\r\n        break;\r\n      case 'uniqueValue':\r\n        rend = uniqueValueRenderer(rendererInfo, options);\r\n        break;\r\n      default:\r\n        rend = simpleRenderer(rendererInfo, options);\r\n    }\r\n    rend.attachStylesToLayer(this);\r\n  };\r\n}\r\n\r\nEsri.FeatureLayer.addInitHook(function () {\r\n  // the only method not shared with the clustered implementation\r\n  L.Util.bind(this.createNewLayer, this);\r\n  wireUpRenderers();\r\n});\r\n\r\nif (L.esri.Cluster) {\r\n  L.esri.Cluster.FeatureLayer.addInitHook(wireUpRenderers);\r\n}\r\n"],"names":["Symbol","L","Class","extend","initialize","symbolJson","options","this","_symbolJson","val","_styles","_isDefault","_layerTransparency","layerTransparency","pixelValue","pointValue","colorValue","color","alphaValue","getSize","feature","sizeInfo","attr","properties","field","size","featureValue","minSize","maxSize","minDataValue","maxDataValue","normField","normalizationField","normValue","parseFloat","undefined","isNaN","getColor","colorInfo","stops","lowerBoundColor","upperBoundColor","lowerBound","upperBound","value","lastStop","length","i","stopInfo","range","upperBoundColorWeight","lowerBoundColorWeight","interpolatedColor","j","Math","round","ShapeMarker","Path","latlng","setOptions","_size","_latlng","latLng","_svgCanvasIncludes","toGeoJSON","GeoJSON","getFeature","type","coordinates","latLngToCoords","getLatLng","_project","_point","_map","latLngToLayerPoint","_update","_updatePath","setLatLng","redraw","fire","setSize","CrossMarker","prototype","call","_renderer","_updateCrossMarker","Canvas","include","layer","offset","ctx","_ctx","beginPath","moveTo","x","y","lineTo","_fillStroke","SVG","Browser","vml","_round","str","_setPath","XMarker","_updateXMarker","SquareMarker","fill","_updateSquareMarker","closePath","svg","DiamondMarker","_updateDiamondMarker","PointSymbol","statics","MARKERTYPES","url","imageUrl","serviceUrl","substr","sanitize","_iconUrl","token","imageData","contentType","_icons","icon","_createIcon","_fillStyles","text","replace","ex","outline","style","stroke","weight","width","opacity","fillColor","fillOpacity","radius","height","xOffset","yOffset","xoffset","yoffset","iconUrl","iconSize","iconAnchor","toString","_getIcon","pointToLayer","geojson","visualVariables","calculatedSize","layerOptions","marker","circleMarker","pointSymbol","LineSymbol","LINETYPES","lineCap","lineJoin","dashValues","dashArray","join","lineSymbol","PolygonSymbol","POLYGONTYPES","_lineStyles","styleAttr","indexOf","polygonSymbol","Renderer","proportionalPolygon","clickable","rendererJson","_rendererJson","_pointSymbols","_symbols","_visualVariables","_parseVisualVariables","Util","visVars","_createDefaultSymbol","defaultSymbol","_defaultSymbol","_newSymbol","_getSymbol","attachStylesToLayer","bind","_originalStyle","sym","userStyles","userDefinedStyle","mergeStyles","styles","mergedStyles","hasOwnProperty","SimpleRenderer","_createSymbol","symbol","push","simpleRenderer","ClassBreaksRenderer","_field","normalizationType","_normalizationField","_createSymbols","classbreaks","classBreakInfos","backgroundFillSymbol","classMaxValue","sort","a","b","_maxValue","classBreaksRenderer","UniqueValueRenderer","field1","uniques","uniqueValueInfos","val2","val3","fieldDelimiter","field2","field3","uniqueValueRenderer","wireUpRenderers","oldOnAdd","oldUnbindPopup","oldOnRemove","ignoreRenderer","onAdd","unbindPopup","onRemove","map","metadata","error","response","console","warn","drawingInfo","pane","geometryType","_setRenderers","_addPointLayer","_pointLayer","pointLayers","getLayers","removeLayer","addTo","bringToFront","_createPointLayer","geoJson","_pointLayerIds","_popup","onEachFeature","bindPopup","_popupOptions","createNewLayer","centroid","featureId","pointjson","fLayer","geometryToLayer","_hasProportionalSymbols","getPolygonCentroid","geometry","id","getPointJson","addData","pts","p1","p2","f","twicearea","nPts","_checkForProportionalSymbols","renderer","serviceInfo","rend","rendererInfo","transparency","Esri","FeatureLayer","addInitHook","esri","Cluster"],"mappings":"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"}