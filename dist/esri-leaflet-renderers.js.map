{"version":3,"file":"esri-leaflet-renderers.js","sources":["../src/EsriLeafletRenderers.js","../src/Symbols/Symbol.js","../src/Symbols/PointSymbol.js","../src/Symbols/LineSymbol.js","../src/Symbols/PolygonSymbol.js","../src/Renderers/Renderer.js","../src/Renderers/SimpleRenderer.js","../src/Renderers/ClassBreaksRenderer.js","../src/Renderers/UniqueValueRenderer.js","../src/Markers/SquareMarker.js","../src/Markers/DiamondMarker.js","../src/Markers/CrossMarker.js","../src/Markers/XMarker.js","../src/FeatureLayerHook.js"],"names":["EsriLeafletRenderers","VERSION","window","L","esri","Renderers","Esri","Symbol","Class","extend","initialize","symbolJson","this","_symbolJson","val","_styles","_isDefault","pixelValue","pointValue","colorValue","color","alphaValue","getSize","feature","sizeInfo","attr","properties","field","size","featureValue","featureRatio","minSize","maxSize","minDataValue","maxDataValue","normField","normalizationField","normValue","parseFloat","undefined","isNaN","getColor","colorInfo","stops","lowerBoundColor","upperBoundColor","lowerBound","upperBound","value","lastStop","length","i","stopInfo","range","upperBoundColorWeight","lowerBoundColorWeight","interpolatedColor","j","Math","round","PointSymbol","statics","MARKERTYPES","options","prototype","call","serviceUrl","url","type","_iconUrl","_icons","icon","_createIcon","_fillStyles","outline","stroke","weight","width","opacity","fillColor","fillOpacity","style","radius","height","xOffset","yOffset","xoffset","yoffset","iconUrl","iconSize","iconAnchor","toString","_getIcon","pointToLayer","geojson","latlng","visualVariables","calculatedSize","marker","squareMarker","diamondMarker","crossMarker","xMarker","circleMarker","pointSymbol","LineSymbol","LINETYPES","lineCap","lineJoin","dashArray","lineSymbol","PolygonSymbol","POLYGONTYPES","_lineStyles","styleAttr","polygonSymbol","Renderer","proportionalPolygon","clickable","rendererJson","_rendererJson","_pointSymbols","_symbols","_visualVariables","_parseVisualVariables","Util","setOptions","visVars","_createDefaultSymbol","defaultSymbol","_defaultSymbol","_newSymbol","_getSymbol","attachStylesToLayer","layer","bind","sym","SimpleRenderer","_createSymbol","symbol","push","simpleRenderer","ClassBreaksRenderer","_field","normalizationType","_normalizationField","_createSymbols","classbreaks","classBreakInfos","backgroundFillSymbol","classMaxValue","sort","a","b","_maxValue","classBreaksRenderer","UniqueValueRenderer","field1","uniques","uniqueValueInfos","uniqueValueRenderer","SquareMarker","Path","fill","center","_size","_center","projectLatlngs","_point","_map","latLngToLayerPoint","getPathString","offset","VML","_round","str","x","y","Browser","svg","setLatLng","redraw","getLatLng","latLng","setSize","DiamondMarker","CrossMarker","XMarker","FeatureLayer","addInitHook","oldOnAdd","onAdd","oldUnbindPopup","unbindPopup","oldOnRemove","onRemove","createNewLayer","metadata","error","response","drawingInfo","_setRenderers","_metadataLoaded","_loadedMap","_addPointLayer","map","_pointLayer","pointLayers","getLayers","removeLayer","addTo","bringToFront","_createPointLayer","geoJson","_pointLayerIds","_popup","popupFunction","bindPopup","_popupOptions","onEachFeature","fLayer","GeoJSON","geometryToLayer","coordsToLatLng","_hasProportionalSymbols","centroid","getPolygonCentroid","geometry","coordinates","featureId","id","pointjson","getPointJson","addData","pts","p1","p2","f","twicearea","nPts","_checkForProportionalSymbols","geometryType","renderer","rend","rendererInfo","_service","pRend"],"mappings":"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","sourcesContent":["var EsriLeafletRenderers = {\n  VERSION: '0.0.1-beta.3'\n};\n\n// attach to the L.esri global if we can\nif(typeof window !== 'undefined' && window.L && window.L.esri) {\n  window.L.esri.Renderers = EsriLeafletRenderers;\n}\n\n// We do not have an 'Esri' variable e.g loading this file directly from source define 'Esri'\nif(!Esri){\n  var Esri = window.L.esri;\n}\n","EsriLeafletRenderers.Symbol = L.Class.extend({\n\n  initialize: function(symbolJson){\n    this._symbolJson = symbolJson;\n    this.val = null;\n    this._styles = {};\n    this._isDefault = false;\n  },\n\n  //the geojson values returned are in points\n  pixelValue: function(pointValue){\n    return pointValue * 1.3333333333333;\n  },\n\n  //color is an array [r,g,b,a]\n  colorValue: function(color){\n    return 'rgb(' + color[0] + ',' + color[1] + ',' + color[2] + ')';\n  },\n\n  alphaValue: function(color){\n    return color[3] / 255.0;\n  },\n\n  getSize: function(feature, sizeInfo) {\n\n    var attr = feature.properties,\n    field = sizeInfo.field,\n    size = 0,\n    featureValue = null;\n\n    if(field){\n      featureValue = attr[field];\n      var minSize = sizeInfo.minSize,\n      maxSize = sizeInfo.maxSize,\n      minDataValue = sizeInfo.minDataValue,\n      maxDataValue = sizeInfo.maxDataValue,\n      featureRatio,\n      normField = sizeInfo.normalizationField,\n      normValue = attr ? parseFloat(attr[normField]) : undefined;\n\n      if(featureValue === null || (normField && ((isNaN(normValue) || normValue === 0)))){\n       return null;\n      }\n\n      if(!isNaN(normValue)){\n        featureValue /= normValue;\n      }\n\n      if(minSize !== null && maxSize !== null && minDataValue !== null && maxDataValue !== null){\n        if(featureValue <= minDataValue){\n          size = minSize;\n        }\n        else if(featureValue >= maxDataValue){\n          size = maxSize;\n        }\n        else{\n          featureRatio = (featureValue - minDataValue) / (maxDataValue - minDataValue);\n          size = minSize + (featureRatio * (maxSize - minSize));\n        }\n      }\n      size = isNaN(size) ? 0 : size;\n    }\n    return size;\n  },\n\n  getColor: function(feature, colorInfo) {\n    //required information to get color\n    if(!(feature.properties && colorInfo && colorInfo.field && colorInfo.stops)){\n      return null;\n    }\n\n    var attr = feature.properties;\n    var featureValue = attr[colorInfo.field];\n    var lowerBoundColor, upperBoundColor, lowerBound, upperBound;\n    var normField = colorInfo.normalizationField;\n    var normValue = attr ? parseFloat(attr[normField]) : undefined;\n    if(featureValue === null || (normField && ((isNaN(normValue) || normValue === 0)))){\n      return null;\n    }\n\n    if(!isNaN(normValue)){\n      featureValue /= normValue;\n    }\n\n    if(featureValue <= colorInfo.stops[0].value){\n      return colorInfo.stops[0].color;\n    }\n    var lastStop = colorInfo.stops[colorInfo.stops.length - 1];\n    if(featureValue >= lastStop.value){\n      return lastStop.color;\n    }\n\n    //go through the stops to find min and max\n    for(var i=0; i<colorInfo.stops.length; i++){\n      var stopInfo = colorInfo.stops[i];\n\n      if(stopInfo.value <= featureValue){\n        lowerBoundColor = stopInfo.color;\n        lowerBound = stopInfo.value;\n\n      }else if(stopInfo.value > featureValue){\n        upperBoundColor = stopInfo.color;\n        upperBound = stopInfo.value;\n        break;\n      }\n    }\n\n    //feature falls between two stops, interplate the colors\n    if(!isNaN(lowerBound) && !isNaN(upperBound)){\n      var range = upperBound - lowerBound;\n      if(range > 0){\n        //more weight the further it is from the lower bound\n        var upperBoundColorWeight = (featureValue - lowerBound) / range;\n        if(upperBoundColorWeight){\n          //more weight the further it is from the upper bound\n          var lowerBoundColorWeight = (upperBound - featureValue) / range;\n          if(lowerBoundColorWeight){\n\n            //interpolate the lower and upper bound color by applying the\n            //weights to each of the rgba colors and adding them together\n            var interpolatedColor = [];\n            for(var j=0; j<4; j++){\n              interpolatedColor[j] = Math.round(lowerBoundColor[j] * lowerBoundColorWeight + upperBoundColor[j] * upperBoundColorWeight); \n            }\n            return interpolatedColor;\n          } else {\n            //no difference between featureValue and upperBound, 100% of upperBoundColor\n            return upperBoundColor;\n          }\n        } else {\n          //no difference between featureValue and lowerBound, 100% of lowerBoundColor\n          return lowerBoundColor;\n        }\n      }\n    }\n    //if we get to here, none of the cases apply so return null\n    return null;\n  }\n});\n","EsriLeafletRenderers.PointSymbol = EsriLeafletRenderers.Symbol.extend({\n  statics: {\n    MARKERTYPES:  ['esriSMSCircle','esriSMSCross', 'esriSMSDiamond', 'esriSMSSquare', 'esriSMSX', 'esriPMS']\n  },\n  initialize: function(symbolJson, options){\n    EsriLeafletRenderers.Symbol.prototype.initialize.call(this, symbolJson);\n    if(options) {\n      this.serviceUrl = options.url;\n    }\n    if(symbolJson){\n      if(symbolJson.type === 'esriPMS'){\n        this._iconUrl = this.serviceUrl + 'images/' + this._symbolJson.url;\n        //leaflet does not allow resizing icons so keep a hash of different\n        //icon sizes to try and keep down on the number of icons created\n        this._icons = {};\n        //create base icon\n        this.icon = this._createIcon(this._symbolJson);\n      } else {\n        this._fillStyles();\n      }\n    }\n  },\n\n  _fillStyles: function(){\n    if(this._symbolJson.outline && this._symbolJson.size > 0){\n      this._styles.stroke = true;\n      this._styles.weight = this.pixelValue(this._symbolJson.outline.width);\n      this._styles.color = this.colorValue(this._symbolJson.outline.color);\n      this._styles.opacity = this.alphaValue(this._symbolJson.outline.color);\n    }else{\n      this._styles.stroke = false;\n    }\n    if(this._symbolJson.color){\n      this._styles.fillColor = this.colorValue(this._symbolJson.color);\n      this._styles.fillOpacity = this.alphaValue(this._symbolJson.color);\n    } else {\n      this._styles.fillOpacity = 0;\n    }\n\n    if(this._symbolJson.style === 'esriSMSCircle'){\n      this._styles.radius = this.pixelValue(this._symbolJson.size) / 2.0;\n    }\n  },\n\n  _createIcon: function(options){\n    var width = this.pixelValue(options.width);\n    var height = width;\n    if(options.height){\n      height = this.pixelValue(options.height);\n    }\n    var xOffset = width / 2.0;\n    var yOffset = height / 2.0;\n\n\n    if(options.xoffset){\n       xOffset += this.pixelValue(options.xoffset);\n    }\n    if(options.yoffset){\n      yOffset += this.pixelValue(options.yoffset);\n    }\n\n    var icon = L.icon({\n      iconUrl: this._iconUrl,\n      iconSize: [width, height],\n      iconAnchor: [xOffset, yOffset]\n    });\n    this._icons[options.width.toString()] = icon;\n    return icon;\n  },\n\n  _getIcon: function(size) {\n    //check to see if it is already created by size\n    var icon = this._icons[size.toString()];\n    if(!icon){\n      icon = this._createIcon({width: size});\n    }\n    return icon;\n  },\n\n  pointToLayer: function(geojson, latlng, visualVariables){\n    var size = this._symbolJson.size || this._symbolJson.width;\n    if(!this._isDefault){\n      if( visualVariables.sizeInfo) {\n        var calculatedSize = this.getSize(geojson, visualVariables.sizeInfo);\n        if (calculatedSize) {\n          size = calculatedSize;\n        }\n      }\n      if(visualVariables.colorInfo){\n        var color = this.getColor(geojson, visualVariables.colorInfo);\n        if(color){\n          this._styles.fillColor = this.colorValue(color);\n          this._styles.fillOpacity = this.alphaValue(color);\n        }\n      }\n    }\n\n    if (this._symbolJson.type === 'esriPMS'){\n      return L.marker(latlng, {icon: this._getIcon(size)});\n    }\n    size = this.pixelValue(size);\n\n    switch(this._symbolJson.style){\n      case 'esriSMSSquare':\n        return EsriLeafletRenderers.squareMarker(latlng, size, this._styles);\n      case 'esriSMSDiamond':\n        return EsriLeafletRenderers.diamondMarker(latlng, size, this._styles);\n      case 'esriSMSCross':\n        return EsriLeafletRenderers.crossMarker(latlng, size, this._styles);\n      case 'esriSMSX':\n        return EsriLeafletRenderers.xMarker(latlng, size, this._styles);\n    }\n    this._styles.radius = size / 2.0;\n    return L.circleMarker(latlng, this._styles);\n  }\n});\nEsriLeafletRenderers.pointSymbol = function(symbolJson, options){\n  return new EsriLeafletRenderers.PointSymbol(symbolJson, options);\n};\n","EsriLeafletRenderers.LineSymbol = EsriLeafletRenderers.Symbol.extend({\n  statics: {\n    //Not implemented 'esriSLSNull'\n    LINETYPES:  ['esriSLSDash','esriSLSDot','esriSLSDashDotDot','esriSLSDashDot','esriSLSSolid']\n  },\n  initialize: function(symbolJson){\n    EsriLeafletRenderers.Symbol.prototype.initialize.call(this, symbolJson);\n    this._fillStyles();\n  },\n\n  _fillStyles: function(){\n    //set the defaults that show up on arcgis online\n    this._styles.lineCap = 'butt';\n    this._styles.lineJoin = 'miter';\n\n\n    if (!this._symbolJson){\n      return;\n    }\n\n    if(this._symbolJson.width){\n      this._styles.weight = this.pixelValue(this._symbolJson.width);\n    }\n\n    if(this._symbolJson.color ){\n      this._styles.color = this.colorValue(this._symbolJson.color);\n      this._styles.opacity = this.alphaValue(this._symbolJson.color);\n    }\n\n    //usuing dash patterns pulled from arcgis online (converted to pixels)\n    switch(this._symbolJson.style){\n      case 'esriSLSDash':\n        //4,3\n        this._styles.dashArray = '5,4';\n        break;\n      case 'esriSLSDot':\n        //1,3\n        this._styles.dashArray = '1,4';\n        break;\n      case 'esriSLSDashDot':\n        //8,3,1,3\n        this._styles.dashArray = '11,4,1,4';\n        break;\n      case 'esriSLSDashDotDot':\n        //8,3,1,3,1,3\n        this._styles.dashArray = '11,4,1,4,1,4';\n        break;\n    }\n  },\n\n  style: function(feature, visualVariables){\n    if(!this._isDefault && visualVariables){\n      if(visualVariables.sizeInfo){\n        var calculatedSize = this.pixelValue(this.getSize(feature, visualVariables.sizeInfo));\n        if (calculatedSize) {\n          this._styles.weight = calculatedSize;\n        }\n      }\n      if(visualVariables.colorInfo){\n        var color = this.getColor(feature, visualVariables.colorInfo);\n        if(color){\n          this._styles.color = this.colorValue(color);\n          this._styles.opacity = this.alphaValue(color);\n        }\n      }\n    }\n    return this._styles;\n  }\n});\nEsriLeafletRenderers.lineSymbol = function(symbolJson){\n  return new EsriLeafletRenderers.LineSymbol(symbolJson);\n};\n","EsriLeafletRenderers.PolygonSymbol = EsriLeafletRenderers.Symbol.extend({\n  statics: {\n    //not implemented: 'esriSFSBackwardDiagonal','esriSFSCross','esriSFSDiagonalCross','esriSFSForwardDiagonal','esriSFSHorizontal','esriSFSNull','esriSFSVertical'\n    POLYGONTYPES:  ['esriSFSSolid']\n  },\n  initialize: function(symbolJson){\n    EsriLeafletRenderers.Symbol.prototype.initialize.call(this, symbolJson);\n    if (symbolJson){\n      this._lineStyles = EsriLeafletRenderers.lineSymbol(symbolJson.outline).style();\n      this._fillStyles();\n    }\n  },\n\n  _fillStyles: function(){\n    //set the fill for the polygon\n    if (this._symbolJson) {\n      if (this._symbolJson.color) {\n        this._styles.fillColor = this.colorValue(this._symbolJson.color);\n        this._styles.fillOpacity = this.alphaValue(this._symbolJson.color);\n      } else {\n        this._styles.fillOpacity = 0;\n      }\n    }\n\n    if(this._lineStyles){\n      if(this._lineStyles.weight === 0){\n        //when weight is 0, setting the stroke to false can still look bad\n        //(gaps between the polygons)\n        this._styles.stroke = false;\n      } else {\n        //copy the line symbol styles into this symbol's styles\n        for (var styleAttr in this._lineStyles){\n          this._styles[styleAttr] = this._lineStyles[styleAttr];\n        }\n      }\n    }\n  },\n\n  style: function(feature, visualVariables) {\n    if(!this._isDefault && visualVariables && visualVariables.colorInfo){\n      var color = this.getColor(feature, visualVariables.colorInfo);\n      if(color){\n        this._styles.fillColor = this.colorValue(color);\n        this._styles.fillOpacity = this.alphaValue(color);\n      }\n    }\n    return this._styles;\n  }\n});\nEsriLeafletRenderers.polygonSymbol = function(symbolJson){\n  return new EsriLeafletRenderers.PolygonSymbol(symbolJson);\n};\n","EsriLeafletRenderers.Renderer = L.Class.extend({\n\n  options: {\n    proportionalPolygon: false,\n    clickable: true\n  },\n\n  initialize: function(rendererJson, options){\n    this._rendererJson = rendererJson;\n    this._pointSymbols = false;\n    this._symbols = [];\n    this._visualVariables = this._parseVisualVariables(rendererJson.visualVariables);\n    L.Util.setOptions(this, options);\n  },\n\n  _parseVisualVariables: function(visualVariables){\n    var visVars = {};\n    if (visualVariables) {\n      for (var i = 0; i < visualVariables.length; i++){\n        visVars[visualVariables[i].type] = visualVariables[i];\n      }\n    }\n    return visVars;\n  },\n\n  _createDefaultSymbol: function(){\n    if(this._rendererJson.defaultSymbol){\n      this._defaultSymbol = this._newSymbol(this._rendererJson.defaultSymbol);\n      this._defaultSymbol._isDefault = true;\n    }\n  },\n\n  _newSymbol: function(symbolJson){\n    if(symbolJson.type === 'esriSMS' || symbolJson.type === 'esriPMS'){\n      this._pointSymbols = true;\n      return EsriLeafletRenderers.pointSymbol(symbolJson, this.options);\n    }\n    if(symbolJson.type === 'esriSLS'){\n      return EsriLeafletRenderers.lineSymbol(symbolJson);\n    }\n    if(symbolJson.type === 'esriSFS'){\n      return EsriLeafletRenderers.polygonSymbol(symbolJson);\n    }\n  },\n\n  _getSymbol: function(){\n    //override\n  },\n\n  attachStylesToLayer: function(layer){\n    if(this._pointSymbols){\n      layer.options.pointToLayer = L.Util.bind(this.pointToLayer, this);\n    } else {\n      layer.options.style = L.Util.bind(this.style, this);\n    }\n  },\n\n  pointToLayer: function(geojson, latlng){\n    var sym = this._getSymbol(geojson);\n    if(sym && sym.pointToLayer){\n      return sym.pointToLayer(geojson, latlng, this._visualVariables);\n    }\n    //invisible symbology\n    return L.circleMarker(latlng, {radius: 0, opacity: 0});\n  },\n\n  style: function(feature){\n    //find the symbol to represent this feature\n    var sym = this._getSymbol(feature);\n    if(sym){\n      return sym.style(feature, this._visualVariables);\n    }else{\n      //invisible symbology\n      return {opacity: 0, fillOpacity: 0};\n    }\n  }\n});\n","EsriLeafletRenderers.SimpleRenderer = EsriLeafletRenderers.Renderer.extend({\n\n  initialize: function(rendererJson, options){\n    EsriLeafletRenderers.Renderer.prototype.initialize.call(this, rendererJson, options);\n    this._createSymbol();\n  },\n\n  _createSymbol: function(){\n    if(this._rendererJson.symbol){\n      this._symbols.push(this._newSymbol(this._rendererJson.symbol));\n    }\n  },\n\n  _getSymbol: function(){\n    return this._symbols[0];\n  }\n});\n\nEsriLeafletRenderers.simpleRenderer = function(rendererJson, options){\n  return new EsriLeafletRenderers.SimpleRenderer(rendererJson, options);\n};\n","EsriLeafletRenderers.ClassBreaksRenderer = EsriLeafletRenderers.Renderer.extend({\n\n  initialize: function(rendererJson, options){\n    EsriLeafletRenderers.Renderer.prototype.initialize.call(this, rendererJson, options);\n    this._field = this._rendererJson.field;\n    if (this._rendererJson.normalizationType && this._rendererJson.normalizationType === 'esriNormalizeByField'){\n      this._normalizationField = this._rendererJson.normalizationField;\n    }\n    this._createSymbols();\n  },\n\n  _createSymbols: function(){\n    var symbol,\n        classbreaks = this._rendererJson.classBreakInfos;\n\n    this._symbols = [];\n\n    //create a symbol for each class break\n    for (var i = classbreaks.length  - 1; i >= 0; i--){\n      if(this.options.proportionalPolygon && this._rendererJson.backgroundFillSymbol){\n        symbol = this._newSymbol(this._rendererJson.backgroundFillSymbol);\n      } else {\n        symbol = this._newSymbol(classbreaks[i].symbol);\n      }\n      symbol.val = classbreaks[i].classMaxValue;\n      this._symbols.push(symbol);\n    }\n    //sort the symbols in ascending value\n    this._symbols.sort(function(a, b){\n      return a.val > b.val ? 1 : -1;\n    });\n    this._createDefaultSymbol();\n    this._maxValue = this._symbols[this._symbols.length - 1].val;\n  },\n\n  _getSymbol: function(feature){\n    var val = feature.properties[this._field];\n    if (this._normalizationField){\n      var normValue = feature.properties[this._normalizationField];\n      if (!isNaN(normValue) && normValue !== 0) {\n        val = val / normValue;\n      } else {\n        return this._defaultSymbol;\n      }\n    }\n\n    if(val > this._maxValue){\n      return this._defaultSymbol;\n    }\n    var symbol = this._symbols[0];\n    for (var i = this._symbols.length - 1; i >= 0; i--){\n      if(val > this._symbols[i].val){\n        break;\n      }\n      symbol = this._symbols[i];\n    }\n    return symbol;\n  }\n});\n\nEsriLeafletRenderers.classBreaksRenderer = function(rendererJson, options){\n  return new EsriLeafletRenderers.ClassBreaksRenderer(rendererJson, options);\n};\n","EsriLeafletRenderers.UniqueValueRenderer = EsriLeafletRenderers.Renderer.extend({\n\n  initialize: function(rendererJson, options){\n    EsriLeafletRenderers.Renderer.prototype.initialize.call(this, rendererJson, options);\n\n    //what to do when there are other fields?\n    this._field = this._rendererJson.field1;\n    this._createSymbols();\n  },\n\n  _createSymbols: function(){\n    var symbol, uniques = this._rendererJson.uniqueValueInfos;\n\n    //create a symbol for each unique value\n    for (var i = uniques.length  - 1; i >= 0; i--){\n      symbol = this._newSymbol(uniques[i].symbol);\n      symbol.val = uniques[i].value;\n      this._symbols.push(symbol);\n    }\n    this._createDefaultSymbol();\n  },\n\n  /* jshint ignore:start */\n  _getSymbol: function(feature){\n    var val = feature.properties[this._field];\n    var symbol = this._defaultSymbol;\n    for (var i = this._symbols.length  - 1; i >= 0; i--){\n      //using the === operator does not work if the field\n      //of the unique renderer is not a string\n      if(this._symbols[i].val == val){\n        symbol = this._symbols[i];\n      }\n    }\n    return symbol;\n  }\n  /* jshint ignore:end */\n});\n\nEsriLeafletRenderers.uniqueValueRenderer = function(rendererJson, options){\n  return new EsriLeafletRenderers.UniqueValueRenderer(rendererJson, options);\n};\n","EsriLeafletRenderers.SquareMarker = L.Path.extend({\n  options: {\n    fill: true\n  },\n\n  initialize: function(center, size, options){\n    L.Path.prototype.initialize.call(this, options);\n    this._size = size;\n    this._center = center;\n  },\n\n  projectLatlngs: function(){\n    this._point = this._map.latLngToLayerPoint(this._center);\n  },\n\n  getPathString: function(){\n    if (!this._map){\n      return '';\n    }\n\n    var center = this._point,\n        offset = this._size / 2.0;\n\n    if(L.Path.VML){\n      center._round();\n      offset = Math.round(offset);\n    }\n\n    var str = 'M' + (center.x + offset) + ',' + (center.y + offset) +\n      'L' + (center.x - offset) + ',' + (center.y + offset) +\n      'L' + (center.x - offset) + ',' + (center.y - offset) +\n      'L' + (center.x + offset) + ',' + (center.y - offset);\n\n    return str + (L.Browser.svg ? 'z' : 'x');\n  },\n\n  setLatLng: function(latlng){\n    this._center = latlng;\n    return this.redraw();\n  },\n\n  getLatLng: function(){\n    return L.latLng(this._center);\n  },\n\n  getSize: function(){\n    return this._size;\n  },\n\n  setSize: function(size){\n    this._size = size;\n    return this.redraw();\n  }\n});\n\nEsriLeafletRenderers.squareMarker = function(center, size, options){\n  return new EsriLeafletRenderers.SquareMarker(center, size, options);\n};\n","EsriLeafletRenderers.DiamondMarker = L.Path.extend({\n  options: {\n    fill: true\n  },\n\n  initialize: function(center, size, options){\n    L.Path.prototype.initialize.call(this, options);\n    this._size = size;\n    this._center = center;\n  },\n\n  projectLatlngs: function(){\n    this._point = this._map.latLngToLayerPoint(this._center);\n  },\n\n  getPathString: function(){\n    if (!this._map){\n      return '';\n    }\n\n    var center = this._point,\n        offset = this._size / 2.0;\n\n    if(L.Path.VML){\n      center._round();\n      offset = Math.round(offset);\n    }\n\n    var str = 'M' + center.x + ',' + (center.y + offset) +\n      'L' + (center.x - offset) + ',' + center.y +\n      'L' + center.x + ',' + (center.y - offset) +\n      'L' + (center.x + offset) + ',' + center.y;\n\n    return str + (L.Browser.svg ? 'z' : 'x');\n  },\n\n  setLatLng: function(latlng){\n    this._center = latlng;\n    return this.redraw();\n  },\n\n  getLatLng: function(){\n    return L.latLng(this._center);\n  },\n\n  getSize: function(){\n    return this._size;\n  },\n\n  setSize: function(size){\n    this._size = size;\n    return this.redraw();\n  }\n});\n\nEsriLeafletRenderers.diamondMarker = function(center, size, options){\n  return new EsriLeafletRenderers.DiamondMarker(center, size, options);\n};\n","EsriLeafletRenderers.CrossMarker = L.Path.extend({\n  initialize: function (center, size, options){\n    L.Path.prototype.initialize.call(this, options);\n    this._size = size;\n    this._center = center;\n  },\n\n  projectLatlngs: function(){\n    this._point = this._map.latLngToLayerPoint(this._center);\n  },\n\n  getPathString: function(){\n    if (!this._map){\n      return '';\n    }\n\n    var center = this._point,\n        offset = this._size / 2.0;\n\n    if(L.Path.VML){\n      center._round();\n      offset = Math.round(offset);\n    }\n\n    return 'M' + center.x + ',' + (center.y + offset) +\n      'L' + center.x + ',' + (center.y - offset) +\n      'M' + (center.x - offset) + ',' + center.y +\n      'L' + (center.x + offset) + ',' + center.y;\n  },\n\n  setLatLng: function(latlng){\n    this._center = latlng;\n    return this.redraw();\n  },\n\n  getLatLng: function(){\n    return L.latLng(this._center);\n  },\n\n  getSize: function(){\n    return this._size;\n  },\n\n  setSize: function(size){\n    this._size = size;\n    return this.redraw();\n  }\n});\n\nEsriLeafletRenderers.crossMarker = function(center, size, options){\n  return new EsriLeafletRenderers.CrossMarker(center, size, options);\n};\n","EsriLeafletRenderers.XMarker = L.Path.extend({\n  initialize: function(center, size, options){\n    L.Path.prototype.initialize.call(this, options);\n    this._size = size;\n    this._center = center;\n  },\n\n  projectLatlngs: function(){\n    this._point = this._map.latLngToLayerPoint(this._center);\n  },\n\n  getPathString: function(){\n    if (!this._map){\n      return '';\n    }\n\n    var center = this._point,\n        offset = this._size / 2.0;\n\n    if(L.Path.VML){\n      center._round();\n      offset = Math.round(offset);\n    }\n\n    return 'M' + (center.x + offset) + ',' + (center.y + offset) +\n      'L' + (center.x - offset) + ',' + (center.y - offset) +\n      'M' + (center.x - offset) + ',' + (center.y + offset) +\n      'L' + (center.x + offset) + ',' + (center.y - offset);\n  },\n\n  setLatLng: function(latlng){\n    this._center = latlng;\n    return this.redraw();\n  },\n\n  getLatLng: function(){\n    return L.latLng(this._center);\n  },\n\n  getSize: function(){\n    return this._size;\n  },\n\n  setSize: function(size){\n    this._size = size;\n    return this.redraw();\n  }\n});\n\nEsriLeafletRenderers.xMarker = function(center, size, options){\n  return new EsriLeafletRenderers.XMarker(center, size, options);\n};\n","Esri.FeatureLayer.addInitHook(function() {\n  var oldOnAdd = L.Util.bind(this.onAdd, this);\n  var oldUnbindPopup = L.Util.bind(this.unbindPopup, this);\n  var oldOnRemove = L.Util.bind(this.onRemove, this);\n  L.Util.bind(this.createNewLayer, this);\n\n  this.metadata(function(error, response) {\n    if(response && response.drawingInfo && !this.options.style){\n      this._setRenderers(response);\n    }\n\n    this._metadataLoaded = true;\n    if(this._loadedMap){\n      oldOnAdd(this._loadedMap);\n      this._addPointLayer(this._loadedMap);\n    }\n  }, this);\n\n  this.onAdd = function(map){\n\n    this._loadedMap = map;\n    if(this._metadataLoaded){\n      oldOnAdd(this._loadedMap);\n      this._addPointLayer(this._loadedMap);\n    }\n  };\n\n  this.onRemove = function(map){\n    oldOnRemove(map);\n    if(this._pointLayer){\n      var pointLayers = this._pointLayer.getLayers();\n      for(var i in pointLayers){\n        map.removeLayer(pointLayers[i]);\n      }\n    }\n  };\n\n  this.unbindPopup = function(){\n    oldUnbindPopup();\n    if(this._pointLayer){\n      var pointLayers = this._pointLayer.getLayers();\n      for(var i in pointLayers){\n        pointLayers[i].unbindPopup();\n      }\n    }\n  };\n\n  this._addPointLayer = function(map){\n    if(this._pointLayer){\n      this._pointLayer.addTo(map);\n      this._pointLayer.bringToFront();\n    }\n  };\n\n  this._createPointLayer = function(){\n    if(!this._pointLayer){\n      this._pointLayer = L.geoJson();\n      //store the feature ids that have already been added to the map\n      this._pointLayerIds = {};\n\n      if(this._popup){\n        var popupFunction = function (feature, layer) {\n          layer.bindPopup(this._popup(feature, layer), this._popupOptions);\n        };\n        this._pointLayer.options.onEachFeature = L.Util.bind(popupFunction, this);\n      }\n    }\n  };\n\n  this.createNewLayer = function(geojson){\n\n    var fLayer = L.GeoJSON.geometryToLayer(geojson, this.options.pointToLayer, L.GeoJSON.coordsToLatLng, this.options);\n\n    //add a point layer when the polygon is represented as proportional marker symbols\n    if(this._hasProportionalSymbols){\n      var centroid = this.getPolygonCentroid(geojson.geometry.coordinates);\n      if(!(isNaN(centroid[0]) || isNaN(centroid[0]))){\n        this._createPointLayer();\n\n        var featureId = geojson.id.toString();\n        //only add the feature if it does not already exist on the map\n        if(!this._pointLayerIds[featureId]){\n          var pointjson = this.getPointJson(geojson, centroid);\n\n          this._pointLayer.addData(pointjson);\n          this._pointLayerIds[featureId] = true;\n        }\n\n        this._pointLayer.bringToFront();\n      }\n    }\n    return fLayer;\n  };\n\n  this.getPolygonCentroid = function(coordinates){\n    var pts = coordinates[0][0];\n    if(pts.length === 2){\n      pts = coordinates[0];\n    }\n\n\n    var twicearea=0,\n    x=0, y=0,\n    nPts = pts.length,\n    p1, p2, f;\n\n    for (var i=0, j=nPts-1 ;i<nPts;j=i++) {\n      p1=pts[i]; p2=pts[j];\n      twicearea+=p1[0]*p2[1];\n      twicearea-=p1[1]*p2[0];\n      f=p1[0]*p2[1]-p2[0]*p1[1];\n      x+=(p1[0]+p2[0])*f;\n      y+=(p1[1]+p2[1])*f;\n    }\n    f=twicearea*3;\n    return [x/f,y/f];\n  };\n\n  this.getPointJson = function(geojson, centroid){\n    return {\n      type: 'Feature',\n      properties: geojson.properties,\n      id: geojson.id,\n      geometry: {\n        type: 'Point',\n        coordinates: [centroid[0],centroid[1]]\n      }\n    };\n  };\n\n  this._checkForProportionalSymbols = function(geometryType, renderer){\n    this._hasProportionalSymbols = false;\n    if(geometryType === 'esriGeometryPolygon'){\n      if(renderer.backgroundFillSymbol){\n        this._hasProportionalSymbols = true;\n      }\n      //check to see if the first symbol in the classbreaks is a marker symbol\n      if(renderer.classBreakInfos && renderer.classBreakInfos.length){\n\n        var sym = renderer.classBreakInfos[0].symbol;\n        if(sym && (sym.type === 'esriSMS' || sym.type === 'esriPMS')){\n          this._hasProportionalSymbols = true;\n        }\n      }\n    }\n  };\n\n  this._setRenderers = function(geojson){\n    var rend,\n    rendererInfo = geojson.drawingInfo.renderer,\n    options = {url: this.url ? this.url : this._service.options.url};\n\n    switch(rendererInfo.type){\n      case 'classBreaks':\n        this._checkForProportionalSymbols(geojson.geometryType, rendererInfo);\n        if(this._hasProportionalSymbols){\n          this._createPointLayer();\n          var pRend = EsriLeafletRenderers.classBreaksRenderer(rendererInfo, options);\n          pRend.attachStylesToLayer(this._pointLayer);\n          options.proportionalPolygon = true;\n        }\n        rend = EsriLeafletRenderers.classBreaksRenderer(rendererInfo, options);\n        break;\n      case 'uniqueValue':\n        rend = EsriLeafletRenderers.uniqueValueRenderer(rendererInfo, options);\n        break;\n      default:\n        rend = EsriLeafletRenderers.simpleRenderer(rendererInfo, options);\n    }\n    rend.attachStylesToLayer(this);\n  };\n});\n"]}