{"version":3,"file":"esri-leaflet-renderers.js","sources":["../src/EsriLeafletRenderers.js","../src/Symbols/Symbol.js","../src/Symbols/PointSymbol.js","../src/Symbols/LineSymbol.js","../src/Symbols/PolygonSymbol.js","../src/Renderers/Renderer.js","../src/Renderers/SimpleRenderer.js","../src/Renderers/ClassBreaksRenderer.js","../src/Renderers/UniqueValueRenderer.js","../src/Markers/SquareMarker.js","../src/Markers/DiamondMarker.js","../src/Markers/CrossMarker.js","../src/Markers/XMarker.js","../src/FeatureLayerHook.js"],"names":["EsriLeafletRenderers","VERSION","window","L","esri","Renderers","Esri","Symbol","Class","extend","initialize","symbolJson","this","_symbolJson","val","_styles","pixelValue","pointValue","colorValue","color","alphaValue","PointSymbol","statics","MARKERTYPES","options","prototype","call","serviceUrl","url","type","_createIcon","_fillStyles","outline","size","stroke","weight","width","opacity","fillColor","fillOpacity","style","radius","height","xOffset","xoffset","yOffset","yoffset","icon","iconUrl","iconSize","iconAnchor","pointToLayer","geojson","latlng","marker","squareMarker","diamondMarker","crossMarker","xMarker","circleMarker","pointSymbol","LineSymbol","LINETYPES","lineCap","lineJoin","dashArray","lineSymbol","PolygonSymbol","POLYGONTYPES","_lineStyles","styleAttr","polygonSymbol","Renderer","proportionalPolygon","clickable","rendererJson","_rendererJson","_pointSymbols","_symbols","Util","setOptions","_createDefaultSymbol","defaultSymbol","_defaultSymbol","_newSymbol","_getSymbol","attachStylesToLayer","layer","bind","sym","feature","SimpleRenderer","_createSymbol","symbol","push","simpleRenderer","ClassBreaksRenderer","_field","field","_createSymbols","classbreaks","classBreakInfos","i","length","backgroundFillSymbol","classMaxValue","sort","a","b","_maxValue","properties","classBreaksRenderer","UniqueValueRenderer","field1","uniques","uniqueValueInfos","value","uniqueValueRenderer","SquareMarker","Path","fill","center","_size","_center","projectLatlngs","_point","_map","latLngToLayerPoint","getPathString","offset","VML","_round","Math","round","str","x","y","Browser","svg","setLatLng","redraw","getLatLng","latLng","getSize","setSize","DiamondMarker","CrossMarker","XMarker","FeatureLayer","addInitHook","oldOnAdd","onAdd","oldUnbindPopup","unbindPopup","oldOnRemove","onRemove","createNewLayer","_metadataLoaded","metadata","error","response","drawingInfo","_setRenderers","_addToMap","map","_addPointLayer","_pointLayer","pointLayers","getLayers","removeLayer","addTo","bringToFront","_createPointLayer","geoJson","_popup","popupFunction","bindPopup","_popupOptions","onEachFeature","fLayer","GeoJSON","geometryToLayer","coordsToLatLng","_hasProportionalSymbols","centroid","getPolygonCentroid","geometry","coordinates","isNaN","pointjson","getPointJson","addData","pts","p1","p2","f","twicearea","nPts","j","id","_checkForProportionalSymbols","geometryType","renderer","rend","rendererInfo","pRend"],"mappings":"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","sourcesContent":["var EsriLeafletRenderers = {\n  VERSION: '0.0.1'//,\n  //Renderers: {}\n};\n\n// attach to the L.esri global if we can\nif(typeof window !== 'undefined' && window.L && window.L.esri) {\n  window.L.esri.Renderers = EsriLeafletRenderers;\n}\n\n// We do not have an 'Esri' variable e.g loading this file directly from source define 'Esri'\nif(!Esri){\n  var Esri = window.L.esri;\n}","EsriLeafletRenderers.Symbol = L.Class.extend({\n\n  initialize: function(symbolJson){\n    this._symbolJson = symbolJson;\n    this.val = null;\n    this._styles = {};\n  },\n\n  //the geojson values returned are in points\n  pixelValue: function(pointValue){\n    return pointValue * 1.3333333333333;\n  },\n\n  //color is an array [r,g,b,a]\n  colorValue: function(color){\n    return 'rgb(' + color[0] + ',' + color[1] + ',' + color[2] + ')';\n  },\n\n  alphaValue: function(color){\n    return color[3] / 255.0;\n  }\n});\n","EsriLeafletRenderers.PointSymbol = EsriLeafletRenderers.Symbol.extend({\n  statics: {\n    MARKERTYPES:  ['esriSMSCircle','esriSMSCross', 'esriSMSDiamond', 'esriSMSSquare', 'esriSMSX', 'esriPMS']\n  },\n  initialize: function(symbolJson, options){\n    EsriLeafletRenderers.Symbol.prototype.initialize.call(this, symbolJson);\n    if(options) {\n      this.serviceUrl = options.url;\n    }\n    if(symbolJson){\n      if(symbolJson.type === 'esriPMS'){\n        this._createIcon();\n      } else {\n        this._fillStyles();\n      }\n    }\n  },\n\n  _fillStyles: function(){\n    if(this._symbolJson.outline && this._symbolJson.size > 0){\n      this._styles.stroke = true;\n      this._styles.weight = this.pixelValue(this._symbolJson.outline.width);\n      this._styles.color = this.colorValue(this._symbolJson.outline.color);\n      this._styles.opacity = this.alphaValue(this._symbolJson.outline.color);\n    }else{\n      this._styles.stroke = false;\n    }\n    if(this._symbolJson.color){\n      this._styles.fillColor = this.colorValue(this._symbolJson.color);\n      this._styles.fillOpacity = this.alphaValue(this._symbolJson.color);\n    }\n\n    if(this._symbolJson.style === 'esriSMSCircle'){\n      this._styles.radius = this.pixelValue(this._symbolJson.size) / 2.0;\n    }\n  },\n\n  _createIcon: function(){\n    var height = this.pixelValue(this._symbolJson.height);\n    var width = this.pixelValue(this._symbolJson.width);\n    var xOffset = width / 2.0 + this.pixelValue(this._symbolJson.xoffset);\n    var yOffset = height / 2.0 + this.pixelValue(this._symbolJson.yoffset);\n    var url = this.serviceUrl + 'images/' + this._symbolJson.url;\n\n    this.icon = L.icon({\n      iconUrl: url,\n      iconSize: [width, height],\n      iconAnchor: [xOffset, yOffset]\n    });\n  },\n  pointToLayer: function(geojson, latlng){\n    if (this._symbolJson.type === 'esriPMS'){\n      return L.marker(latlng, {icon: this.icon});\n    }\n\n    var size = this.pixelValue(this._symbolJson.size);\n\n    switch(this._symbolJson.style){\n      case 'esriSMSSquare':\n        return EsriLeafletRenderers.squareMarker(latlng, size, this._styles);\n      case 'esriSMSDiamond':\n        return EsriLeafletRenderers.diamondMarker(latlng, size, this._styles);\n      case 'esriSMSCross':\n        return EsriLeafletRenderers.crossMarker(latlng, size, this._styles);\n      case 'esriSMSX':\n        return EsriLeafletRenderers.xMarker(latlng, size, this._styles);\n    }\n    return L.circleMarker(latlng, this._styles);\n  }\n});\nEsriLeafletRenderers.pointSymbol = function(symbolJson, options){\n  return new EsriLeafletRenderers.PointSymbol(symbolJson, options);\n};\n","EsriLeafletRenderers.LineSymbol = EsriLeafletRenderers.Symbol.extend({\n  statics: {\n    //Not implemented 'esriSLSNull'\n    LINETYPES:  ['esriSLSDash','esriSLSDot','esriSLSDashDotDot','esriSLSDashDot','esriSLSSolid']\n  },\n  initialize: function(symbolJson){\n    EsriLeafletRenderers.Symbol.prototype.initialize.call(this, symbolJson);\n    this._fillStyles();\n  },\n\n  _fillStyles: function(){\n    //set the defaults that show up on arcgis online\n    this._styles.lineCap = 'butt';\n    this._styles.lineJoin = 'miter';\n\n\n    if (!this._symbolJson){\n      return;\n    }\n\n    if(this._symbolJson.width){\n      this._styles.weight = this.pixelValue(this._symbolJson.width);\n    }\n\n    if(this._symbolJson.color ){\n      this._styles.color = this.colorValue(this._symbolJson.color);\n      this._styles.opacity = this.alphaValue(this._symbolJson.color);\n    }\n\n    //usuing dash patterns pulled from arcgis online (converted to pixels)\n    switch(this._symbolJson.style){\n      case 'esriSLSDash':\n        //4,3\n        this._styles.dashArray = '5,4';\n        break;\n      case 'esriSLSDot':\n        //1,3\n        this._styles.dashArray = '1,4';\n        break;\n      case 'esriSLSDashDot':\n        //8,3,1,3\n        this._styles.dashArray = '11,4,1,4';\n        break;\n      case 'esriSLSDashDotDot':\n        //8,3,1,3,1,3\n        this._styles.dashArray = '11,4,1,4,1,4';\n        break;\n    }\n  },\n\n  style: function(){\n    return this._styles;\n  }\n});\nEsriLeafletRenderers.lineSymbol = function(symbolJson){\n  return new EsriLeafletRenderers.LineSymbol(symbolJson);\n};\n","EsriLeafletRenderers.PolygonSymbol = EsriLeafletRenderers.Symbol.extend({\n  statics: {\n    //not implemented: 'esriSFSBackwardDiagonal','esriSFSCross','esriSFSDiagonalCross','esriSFSForwardDiagonal','esriSFSHorizontal','esriSFSNull','esriSFSVertical'\n    POLYGONTYPES:  ['esriSFSSolid']\n  },\n  initialize: function(symbolJson){\n    EsriLeafletRenderers.Symbol.prototype.initialize.call(this, symbolJson);\n    if (symbolJson){\n      this._lineStyles = EsriLeafletRenderers.lineSymbol(symbolJson.outline).style();\n      this._fillStyles();\n    }\n  },\n\n  _fillStyles: function(){\n    //set the fill for the polygon\n    if (this._symbolJson && this._symbolJson.color){\n      this._styles.fillColor = this.colorValue(this._symbolJson.color);\n      this._styles.fillOpacity = this.alphaValue(this._symbolJson.color);\n    }\n\n    if(this._lineStyles){\n      if(this._lineStyles.weight === 0){\n        //when weight is 0, setting the stroke to false can still look bad\n        //(gaps between the polygons)\n        this._styles.stroke = false;\n      } else {\n        //copy the line symbol styles into this symbol's styles\n        for (var styleAttr in this._lineStyles){\n          this._styles[styleAttr] = this._lineStyles[styleAttr];\n        }\n      }\n    }\n  },\n\n  style: function() {\n    return this._styles;\n  }\n});\nEsriLeafletRenderers.polygonSymbol = function(symbolJson){\n  return new EsriLeafletRenderers.PolygonSymbol(symbolJson);\n};\n","EsriLeafletRenderers.Renderer = L.Class.extend({\n\n  options: {\n    proportionalPolygon: false,\n    clickable: true\n  },\n\n  initialize: function(rendererJson, options){\n    this._rendererJson = rendererJson;\n    this._pointSymbols = false;\n    this._symbols = [];\n    L.Util.setOptions(this, options);\n  },\n\n\n  _createDefaultSymbol: function(){\n    if(this._rendererJson.defaultSymbol){\n      this._defaultSymbol = this._newSymbol(this._rendererJson.defaultSymbol);\n    }\n  },\n\n  _newSymbol: function(symbolJson){\n    if(symbolJson.type === 'esriSMS' || symbolJson.type === 'esriPMS'){\n      this._pointSymbols = true;\n      return EsriLeafletRenderers.pointSymbol(symbolJson, this.options);\n    }\n    if(symbolJson.type === 'esriSLS'){\n      return EsriLeafletRenderers.lineSymbol(symbolJson);\n    }\n    if(symbolJson.type === 'esriSFS'){\n      return EsriLeafletRenderers.polygonSymbol(symbolJson);\n    }\n  },\n\n  _getSymbol: function(){\n    //override\n  },\n\n  attachStylesToLayer: function(layer){\n    if(this._pointSymbols){\n      layer.options.pointToLayer = L.Util.bind(this.pointToLayer, this);\n    } else {\n      layer.options.style = L.Util.bind(this.style, this);\n    }\n  },\n\n  pointToLayer: function(geojson, latlng){\n    var sym = this._getSymbol(geojson);\n    if(sym){\n      return sym.pointToLayer(geojson, latlng);\n    }\n    //invisible symbology\n    return L.circleMarker(latlng, {radius: 0});\n  },\n\n  style: function(feature){\n    //find the symbol to represent this feature\n    var sym = this._getSymbol(feature);\n    if(sym){\n      return sym.style(feature);\n    }else{\n      //invisible symbology\n      return {opacity: 0, fillOpacity: 0};\n    }\n  }\n});\n","EsriLeafletRenderers.SimpleRenderer = EsriLeafletRenderers.Renderer.extend({\n\n  initialize: function(rendererJson, options){\n    EsriLeafletRenderers.Renderer.prototype.initialize.call(this, rendererJson, options);\n    this._createSymbol();\n  },\n\n  _createSymbol: function(){\n    if(this._rendererJson.symbol){\n      this._symbols.push(this._newSymbol(this._rendererJson.symbol));\n    }\n  },\n\n  _getSymbol: function(){\n    return this._symbols[0];\n  }\n});\n\nEsriLeafletRenderers.simpleRenderer = function(rendererJson, options){\n  return new EsriLeafletRenderers.SimpleRenderer(rendererJson, options);\n};\n","EsriLeafletRenderers.ClassBreaksRenderer = EsriLeafletRenderers.Renderer.extend({\n\n  initialize: function(rendererJson, options){\n    EsriLeafletRenderers.Renderer.prototype.initialize.call(this, rendererJson, options);\n    this._field = this._rendererJson.field;\n    this._createSymbols();\n  },\n\n  _createSymbols: function(){\n    var symbol,\n        classbreaks = this._rendererJson.classBreakInfos;\n\n    this._symbols = [];\n\n    //create a symbol for each class break\n    for (var i = classbreaks.length  - 1; i >= 0; i--){\n      if(this.options.proportionalPolygon && this._rendererJson.backgroundFillSymbol){\n        symbol = this._newSymbol(this._rendererJson.backgroundFillSymbol);\n      } else {\n        symbol = this._newSymbol(classbreaks[i].symbol);\n      }\n      symbol.val = classbreaks[i].classMaxValue;\n      this._symbols.push(symbol);\n    }\n    //sort the symbols in ascending value\n    this._symbols.sort(function(a, b){\n      return a.val > b.val ? 1 : -1;\n    });\n    this._createDefaultSymbol();\n    this._maxValue = this._symbols[this._symbols.length - 1].val;\n  },\n\n  _getSymbol: function(feature){\n    var val = feature.properties[this._field];\n    if(val > this._maxValue){\n      return this._defaultSymbol;\n    }\n    var symbol = this._symbols[0];\n    for (var i = this._symbols.length - 1; i >= 0; i--){\n      if(val > this._symbols[i].val){\n        break;\n      }\n      symbol = this._symbols[i];\n    }\n    return symbol;\n  }\n});\n\nEsriLeafletRenderers.classBreaksRenderer = function(rendererJson, options){\n  return new EsriLeafletRenderers.ClassBreaksRenderer(rendererJson, options);\n};\n","EsriLeafletRenderers.UniqueValueRenderer = EsriLeafletRenderers.Renderer.extend({\n\n  initialize: function(rendererJson, options){\n    EsriLeafletRenderers.Renderer.prototype.initialize.call(this, rendererJson, options);\n\n    //what to do when there are other fields?\n    this._field = this._rendererJson.field1;\n    this._createSymbols();\n  },\n\n  _createSymbols: function(){\n    var symbol, uniques = this._rendererJson.uniqueValueInfos;\n\n    //create a symbol for each unique value\n    for (var i = uniques.length  - 1; i >= 0; i--){\n      symbol = this._newSymbol(uniques[i].symbol);\n      symbol.val = uniques[i].value;\n      this._symbols.push(symbol);\n    }\n    this._createDefaultSymbol();\n  },\n\n  /* jshint ignore:start */\n  _getSymbol: function(feature){\n    var val = feature.properties[this._field];\n    var symbol = this._defaultSymbol;\n    for (var i = this._symbols.length  - 1; i >= 0; i--){\n      //using the === operator does not work if the field\n      //of the unique renderer is not a string\n      if(this._symbols[i].val == val){\n        symbol = this._symbols[i];\n      }\n    }\n    return symbol;\n  }\n  /* jshint ignore:end */\n});\n\nEsriLeafletRenderers.uniqueValueRenderer = function(rendererJson, options){\n  return new EsriLeafletRenderers.UniqueValueRenderer(rendererJson, options);\n};\n","EsriLeafletRenderers.SquareMarker = L.Path.extend({\n  options: {\n    fill: true\n  },\n\n  initialize: function(center, size, options){\n    L.Path.prototype.initialize.call(this, options);\n    this._size = size;\n    this._center = center;\n  },\n\n  projectLatlngs: function(){\n    this._point = this._map.latLngToLayerPoint(this._center);\n  },\n\n  getPathString: function(){\n    if (!this._map){\n      return '';\n    }\n\n    var center = this._point,\n        offset = this._size / 2.0;\n\n    if(L.Path.VML){\n      center._round();\n      offset = Math.round(offset);\n    }\n\n    var str = 'M' + (center.x + offset) + ',' + (center.y + offset) +\n      'L' + (center.x - offset) + ',' + (center.y + offset) +\n      'L' + (center.x - offset) + ',' + (center.y - offset) +\n      'L' + (center.x + offset) + ',' + (center.y - offset);\n\n    return str + (L.Browser.svg ? 'z' : 'x');\n  },\n\n  setLatLng: function(latlng){\n    this._center = latlng;\n    return this.redraw();\n  },\n\n  getLatLng: function(){\n    return L.latLng(this._center);\n  },\n\n  getSize: function(){\n    return this._size;\n  },\n\n  setSize: function(size){\n    this._size = size;\n    return this.redraw();\n  }\n});\n\nEsriLeafletRenderers.squareMarker = function(center, size, options){\n  return new EsriLeafletRenderers.SquareMarker(center, size, options);\n};\n","EsriLeafletRenderers.DiamondMarker = L.Path.extend({\n  options: {\n    fill: true\n  },\n\n  initialize: function(center, size, options){\n    L.Path.prototype.initialize.call(this, options);\n    this._size = size;\n    this._center = center;\n  },\n\n  projectLatlngs: function(){\n    this._point = this._map.latLngToLayerPoint(this._center);\n  },\n\n  getPathString: function(){\n    if (!this._map){\n      return '';\n    }\n\n    var center = this._point,\n        offset = this._size / 2.0;\n\n    if(L.Path.VML){\n      center._round();\n      offset = Math.round(offset);\n    }\n\n    var str = 'M' + center.x + ',' + (center.y + offset) +\n      'L' + (center.x - offset) + ',' + center.y +\n      'L' + center.x + ',' + (center.y - offset) +\n      'L' + (center.x + offset) + ',' + center.y;\n\n    return str + (L.Browser.svg ? 'z' : 'x');\n  },\n\n  setLatLng: function(latlng){\n    this._center = latlng;\n    return this.redraw();\n  },\n\n  getLatLng: function(){\n    return L.latLng(this._center);\n  },\n\n  getSize: function(){\n    return this._size;\n  },\n\n  setSize: function(size){\n    this._size = size;\n    return this.redraw();\n  }\n});\n\nEsriLeafletRenderers.diamondMarker = function(center, size, options){\n  return new EsriLeafletRenderers.DiamondMarker(center, size, options);\n};\n","EsriLeafletRenderers.CrossMarker = L.Path.extend({\n  initialize: function (center, size, options){\n    L.Path.prototype.initialize.call(this, options);\n    this._size = size;\n    this._center = center;\n  },\n\n  projectLatlngs: function(){\n    this._point = this._map.latLngToLayerPoint(this._center);\n  },\n\n  getPathString: function(){\n    if (!this._map){\n      return '';\n    }\n\n    var center = this._point,\n        offset = this._size / 2.0;\n\n    if(L.Path.VML){\n      center._round();\n      offset = Math.round(offset);\n    }\n\n    return 'M' + center.x + ',' + (center.y + offset) +\n      'L' + center.x + ',' + (center.y - offset) +\n      'M' + (center.x - offset) + ',' + center.y +\n      'L' + (center.x + offset) + ',' + center.y;\n  },\n\n  setLatLng: function(latlng){\n    this._center = latlng;\n    return this.redraw();\n  },\n\n  getLatLng: function(){\n    return L.latLng(this._center);\n  },\n\n  getSize: function(){\n    return this._size;\n  },\n\n  setSize: function(size){\n    this._size = size;\n    return this.redraw();\n  }\n});\n\nEsriLeafletRenderers.crossMarker = function(center, size, options){\n  return new EsriLeafletRenderers.CrossMarker(center, size, options);\n};\n","EsriLeafletRenderers.XMarker = L.Path.extend({\n  initialize: function(center, size, options){\n    L.Path.prototype.initialize.call(this, options);\n    this._size = size;\n    this._center = center;\n  },\n\n  projectLatlngs: function(){\n    this._point = this._map.latLngToLayerPoint(this._center);\n  },\n\n  getPathString: function(){\n    if (!this._map){\n      return '';\n    }\n\n    var center = this._point,\n        offset = this._size / 2.0;\n\n    if(L.Path.VML){\n      center._round();\n      offset = Math.round(offset);\n    }\n\n    return 'M' + (center.x + offset) + ',' + (center.y + offset) +\n      'L' + (center.x - offset) + ',' + (center.y - offset) +\n      'M' + (center.x - offset) + ',' + (center.y + offset) +\n      'L' + (center.x + offset) + ',' + (center.y - offset);\n  },\n\n  setLatLng: function(latlng){\n    this._center = latlng;\n    return this.redraw();\n  },\n\n  getLatLng: function(){\n    return L.latLng(this._center);\n  },\n\n  getSize: function(){\n    return this._size;\n  },\n\n  setSize: function(size){\n    this._size = size;\n    return this.redraw();\n  }\n});\n\nEsriLeafletRenderers.xMarker = function(center, size, options){\n  return new EsriLeafletRenderers.XMarker(center, size, options);\n};\n","Esri.FeatureLayer.addInitHook(function() {\n  var oldOnAdd = L.Util.bind(this.onAdd, this);\n  var oldUnbindPopup = L.Util.bind(this.unbindPopup, this);\n  var oldOnRemove = L.Util.bind(this.onRemove, this);\n  L.Util.bind(this.createNewLayer, this);\n\n  this._metadataLoaded = false;\n\n  this.metadata(function(error, response) {\n    if(response && response.drawingInfo && !this.options.style){\n      this._setRenderers(response);\n    }\n    this._metadataLoaded = true;\n    /* jshint ignore:start */\n    if(this._addToMap){\n      oldOnAdd(map);\n      this._addPointLayer(map);\n    }\n    /* jshint ignore:end */\n  }, this);\n\n  this.onAdd = function(map){\n    this._addToMap = true;\n    if(this._metadataLoaded){\n      oldOnAdd(map);\n      this._addPointLayer(map);\n    }\n  };\n\n  this.onRemove = function(map){\n    oldOnRemove(map);\n    if(this._pointLayer){\n      var pointLayers = this._pointLayer.getLayers();\n      for(var i in pointLayers){\n        map.removeLayer(pointLayers[i]);\n      }\n    }\n  };\n\n  this.unbindPopup = function(){\n    oldUnbindPopup();\n    if(this._pointLayer){\n      var pointLayers = this._pointLayer.getLayers();\n      for(var i in pointLayers){\n        pointLayers[i].unbindPopup();\n      }\n    }\n  };\n\n  this._addPointLayer = function(map){\n    if(this._pointLayer){\n      this._pointLayer.addTo(map);\n      this._pointLayer.bringToFront();\n    }\n  };\n\n  this._createPointLayer = function(){\n    if(!this._pointLayer){\n      this._pointLayer = L.geoJson();\n\n      if(this._popup){\n        var popupFunction = function (feature, layer) {\n          layer.bindPopup(this._popup(feature, layer), this._popupOptions);\n        };\n        this._pointLayer.options.onEachFeature = L.Util.bind(popupFunction, this);\n      }\n    }\n  };\n\n  this.createNewLayer = function(geojson){\n\n    var fLayer = L.GeoJSON.geometryToLayer(geojson, this.options.pointToLayer, L.GeoJSON.coordsToLatLng, this.options);\n\n    //add a point layer when the polygon is represented as proportional marker symbols\n    if(this._hasProportionalSymbols){\n      var centroid = this.getPolygonCentroid(geojson.geometry.coordinates);\n      if(!(isNaN(centroid[0]) || isNaN(centroid[0]))){\n        this._createPointLayer();\n\n        var pointjson = this.getPointJson(geojson, centroid);\n        this._pointLayer.addData(pointjson);\n        this._pointLayer.bringToFront();\n      }\n    }\n    return fLayer;\n  };\n\n  this.getPolygonCentroid = function(coordinates){\n    var pts = coordinates[0][0];\n    if(pts.length === 2){\n      pts = coordinates[0];\n    }\n\n\n    var twicearea=0,\n    x=0, y=0,\n    nPts = pts.length,\n    p1, p2, f;\n\n    for (var i=0, j=nPts-1 ;i<nPts;j=i++) {\n      p1=pts[i]; p2=pts[j];\n      twicearea+=p1[0]*p2[1];\n      twicearea-=p1[1]*p2[0];\n      f=p1[0]*p2[1]-p2[0]*p1[1];\n      x+=(p1[0]+p2[0])*f;\n      y+=(p1[1]+p2[1])*f;\n    }\n    f=twicearea*3;\n    return [x/f,y/f];\n  };\n\n  this.getPointJson = function(geojson, centroid){\n    return {\n      type: 'Feature',\n      properties: geojson.properties,\n      id: geojson.id,\n      geometry: {\n        type: 'Point',\n        coordinates: [centroid[0],centroid[1]]\n      }\n    };\n  };\n\n  this._checkForProportionalSymbols = function(geometryType, renderer){\n    this._hasProportionalSymbols = false;\n    if(geometryType === 'esriGeometryPolygon'){\n      if(renderer.backgroundFillSymbol){\n        this._hasProportionalSymbols = true;\n      }\n      //check to see if the first symbol in the classbreaks is a marker symbol\n      if(renderer.classBreakInfos && renderer.classBreakInfos.length){\n\n        var sym = renderer.classBreakInfos[0].symbol;\n        if(sym && (sym.type === 'esriSMS' || sym.type === 'esriPMS')){\n          this._hasProportionalSymbols = true;\n        }\n      }\n    }\n  };\n\n  this._setRenderers = function(geojson){\n    var rend,\n    rendererInfo = geojson.drawingInfo.renderer,\n    options = {url: this.url};\n\n    switch(rendererInfo.type){\n      case 'classBreaks':\n        this._checkForProportionalSymbols(geojson.geometryType, rendererInfo);\n        if(this._hasProportionalSymbols){\n          this._createPointLayer();\n          var pRend = EsriLeafletRenderers.classBreaksRenderer(rendererInfo, options);\n          pRend.attachStylesToLayer(this._pointLayer);\n          options.proportionalPolygon = true;\n        }\n        rend = EsriLeafletRenderers.classBreaksRenderer(rendererInfo, options);\n        break;\n      case 'uniqueValue':\n        rend = EsriLeafletRenderers.uniqueValueRenderer(rendererInfo, options);\n        break;\n      default:\n        rend = EsriLeafletRenderers.simpleRenderer(rendererInfo, options);\n    }\n    rend.attachStylesToLayer(this);\n  };\n});\n"]}